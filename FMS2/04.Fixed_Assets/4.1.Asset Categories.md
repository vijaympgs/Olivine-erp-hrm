# FMS BBP - Asset Categories

## **1. MODULE IDENTIFICATION**

**Module Name:** Asset Categories
**Module Number:** 4.1
**Module Type:** Master
**Target File:** FMS/04.Fixed_Assets/4.1.Asset Categories.md
**Created Date:** December 30, 2025
**Version:** 1.0.0
**Author:** BBP System

--- END OF SECTION 1 ---

## **2. PURPOSE**

### **2.1 Business Purpose**
The Asset Categories module provides comprehensive configuration and management of asset classification structures, enabling standardized asset categorization, depreciation method assignment, and asset lifecycle management across the organization's fixed asset portfolio for accurate financial reporting and compliance with accounting standards.

### **2.2 Business Scope**
**In Scope:**
- Asset category creation and hierarchical structure management
- Depreciation method assignment and configuration
- Asset classification rules and validation frameworks
- Asset lifecycle stage definitions and transitions
- Multi-level category hierarchies with parent-child relationships
- Asset category-based reporting and analytics
- Integration with asset acquisition and disposal processes
- Asset category templates for consistent asset creation

**Out of Scope:**
- Actual asset transaction processing (handled by Asset Acquisition module)
- Asset depreciation calculation (handled by Depreciation Methods module)
- Asset maintenance scheduling (handled by Asset Maintenance module)
- Asset disposal and retirement processing (handled by Asset Disposal module)
- Asset reporting and analytics (handled by Asset Reports module)

### **2.3 Key Stakeholders**
- **Asset Managers:** Asset category configuration and classification management
- **Finance Controllers:** Asset categorization oversight and compliance monitoring
- **Accountants:** Asset classification validation and financial reporting
- **Compliance Officers:** Asset classification standards and regulatory compliance
- **External Auditors:** Asset category documentation and audit verification

--- END OF SECTION 2 ---

## **3. CORE MODELS (DJANGO)**

### **3.1 Primary Model: AssetCategory**

```python
class AssetCategory(models.Model):
    """
    Master asset category configuration for standardized asset classification
    """
    
    # Primary Key
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    
    # Foreign Keys
    company_id = models.UUIDField()
    created_by_user_id = models.UUIDField()
    parent_category_id = models.UUIDField(null=True, blank=True)
    
    # Core Fields
    category_code = models.CharField(max_length=50)
    category_name = models.CharField(max_length=200)
    category_description = models.TextField(blank=True)
    category_level = models.IntegerField(default=1)
    
    # Classification Fields
    asset_type = models.CharField(
        max_length=30,
        choices=[
            ('TANGIBLE', 'Tangible Assets'),
            ('INTANGIBLE', 'Intangible Assets'),
            ('FINANCIAL', 'Financial Assets'),
            ('INVESTMENT', 'Investment Properties'),
            ('OTHER', 'Other Assets'),
        ]
    )
    depreciation_method_id = models.UUIDField()
    useful_life_years = models.IntegerField(null=True, blank=True)
    salvage_value_percentage = models.DecimalField(
        max_digits=5, decimal_places=2, null=True, blank=True
    )
    
    # Configuration
    is_active = models.BooleanField(default=True)
    is_system_defined = models.BooleanField(default=False)
    requires_serial_number = models.BooleanField(default=False)
    requires_asset_tag = models.BooleanField(default=True)
    requires_insurance = models.BooleanField(default=False)
    
    # Audit Fields
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'fms_asset_categories'
        verbose_name = 'Asset Category'
        verbose_name_plural = 'Asset Categories'
        indexes = [
            models.Index(fields=['company_id', 'category_code'], name='idx_ac_company_code'),
            models.Index(fields=['parent_category_id'], name='idx_ac_parent'),
            models.Index(fields=['asset_type'], name='idx_ac_type'),
            models.Index(fields=['category_level'], name='idx_ac_level'),
            models.Index(fields=['is_active'], name='idx_ac_active'),
        ]
        constraints = [
            models.UniqueConstraint(fields=['company_id', 'category_code'], name='uk_ac_company_code'),
        ]

class DepreciationMethod(models.Model):
    """
    Depreciation method configuration for asset categories
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    method_code = models.CharField(max_length=50)
    method_name = models.CharField(max_length=200)
    method_description = models.TextField(blank=True)
    
    # Method Configuration
    calculation_type = models.CharField(
        max_length=30,
        choices=[
            ('STRAIGHT_LINE', 'Straight Line'),
            ('DECLINING_BALANCE', 'Declining Balance'),
            ('DOUBLE_DECLINING', 'Double Declining Balance'),
            ('SUM_OF_YEARS_DIGITS', 'Sum of Years Digits'),
            ('UNITS_OF_PRODUCTION', 'Units of Production'),
            ('MACRS', 'Modified Accelerated Cost Recovery System'),
            ('CUSTOM', 'Custom Method'),
        ]
    )
    calculation_formula = models.TextField(blank=True)  # JSON formula definition
    
    # Default Parameters
    default_useful_life_years = models.IntegerField(null=True, blank=True)
    default_salvage_rate = models.DecimalField(
        max_digits=5, decimal_places=2, null=True, blank=True
    )
    
    is_active = models.BooleanField(default=True)
    is_system_defined = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'fms_depreciation_methods'
        verbose_name = 'Depreciation Method'
        verbose_name_plural = 'Depreciation Methods'
        indexes = [
            models.Index(fields=['company_id', 'method_code'], name='idx_dm_company_code'),
            models.Index(fields=['calculation_type'], name='idx_dm_type'),
            models.Index(fields=['is_active'], name='idx_dm_active'),
        ]
        constraints = [
            models.UniqueConstraint(fields=['company_id', 'method_code'], name='uk_dm_company_code'),
        ]

class AssetCategoryRule(models.Model):
    """
    Asset classification rules and validation frameworks
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    asset_category_id = models.UUIDField()
    
    # Rule Configuration
    rule_name = models.CharField(max_length=200)
    rule_type = models.CharField(
        max_length=30,
        choices=[
            ('VALUE_THRESHOLD', 'Value Threshold'),
            ('ASSET_TYPE', 'Asset Type Validation'),
            ('QUANTITY_THRESHOLD', 'Quantity Threshold'),
            ('DEPARTMENT_RESTRICTION', 'Department Restriction'),
            ('COST_CENTER_RESTRICTION', 'Cost Center Restriction'),
            ('APPROVAL_REQUIRED', 'Approval Requirement'),
            ('INSURANCE_MANDATORY', 'Insurance Mandatory'),
        ]
    )
    
    # Rule Conditions
    condition_field = models.CharField(max_length=100)  # Field to validate
    condition_operator = models.CharField(
        max_length=20,
        choices=[
            ('EQUALS', 'Equals'),
            ('NOT_EQUALS', 'Not Equals'),
            ('GREATER_THAN', 'Greater Than'),
            ('LESS_THAN', 'Less Than'),
            ('GREATER_EQUAL', 'Greater Than or Equal'),
            ('LESS_EQUAL', 'Less Than or Equal'),
            ('CONTAINS', 'Contains'),
            ('STARTS_WITH', 'Starts With'),
            ('ENDS_WITH', 'Ends With'),
            ('IN_LIST', 'In List'),
            ('NOT_IN_LIST', 'Not In List'),
        ]
    )
    condition_value = models.TextField()  # JSON or text value
    
    # Rule Actions
    action_type = models.CharField(
        max_length=30,
        choices=[
            ('ALLOW', 'Allow'),
            ('BLOCK', 'Block'),
            ('REQUIRE_APPROVAL', 'Require Approval'),
            ('ASSIGN_CATEGORY', 'Assign Category'),
            ('SEND_NOTIFICATION', 'Send Notification'),
        ]
    )
    action_value = models.TextField(blank=True)  # JSON or text value
    
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'fms_asset_category_rules'
        verbose_name = 'Asset Category Rule'
        verbose_name_plural = 'Asset Category Rules'
        indexes = [
            models.Index(fields=['company_id', 'asset_category_id'], name='idx_acr_company_category'),
            models.Index(fields=['rule_type'], name='idx_acr_type'),
            models.Index(fields=['is_active'], name='idx_acr_active'),
        ]
```

--- END OF SECTION 3 ---

## **4. REFERENCE MODELS (DJANGO)**

### **4.1 Company**

```python
class Company(models.Model):
    """
    Reference to company for multi-tenant support
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_name = models.CharField(max_length=200)
    is_active = models.BooleanField(default=True)
    
    class Meta:
        db_table = 'fms_companies'
        verbose_name = 'Company'
        verbose_name_plural = 'Companies'
```

### **4.2 Asset**

```python
class Asset(models.Model):
    """
    Reference to asset for category assignment
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    asset_category_id = models.UUIDField()
    asset_name = models.CharField(max_length=200)
    is_active = models.BooleanField(default=True)
    
    class Meta:
        db_table = 'fms_assets'
        verbose_name = 'Asset'
        verbose_name_plural = 'Assets'
```

--- END OF SECTION 4 ---

## **5. FOREIGN KEY RELATIONSHIPS**

### **5.1 Primary Relationships**
- **AssetCategory** → **Company**: Multi-tenant support through company_id
- **AssetCategory** → **Parent AssetCategory**: Self-referencing for hierarchical category structures
- **AssetCategory** → **DepreciationMethod**: Many-to-one relationship for depreciation method assignment
- **AssetCategoryRule** → **AssetCategory**: Many-to-one relationship for category-specific rules
- **Asset** → **AssetCategory**: Many-to-one relationship for asset classification

### **5.2 Many-to-Many Relationships**
- **AssetCategory** ↔ **Asset**: Through asset_id for asset categorization
- **AssetCategory** ↔ **DepreciationMethod**: Through depreciation_method_id for method assignment

--- END OF SECTION 5 ---

## **6. BUSINESS RULES & VALIDATIONS**

### **6.1 Data Integrity Rules**
- Asset category codes must be unique within each company
- Category levels must be sequential (no gaps in hierarchy)
- Parent categories must exist at lower levels
- Depreciation methods must be active for category assignment
- Asset categories cannot be deleted if they contain assets
- System-defined categories cannot be modified or deleted

### **6.2 Validation Logic**

```python
def clean_category_code(self):
    """
    Validate asset category code format and uniqueness
    """
    if not re.match(r'^[A-Z0-9]{2,50}$', self.category_code):
        raise ValidationError("Category code must be 2-50 alphanumeric characters")
    
    # Check uniqueness within company
    if AssetCategory.objects.filter(
        company_id=self.company_id,
        category_code=self.category_code
    ).exclude(id=self.id).exists():
        raise ValidationError("Category code must be unique within company")

def clean_category_level(self):
    """
    Validate category level consistency
    """
    if self.parent_category_id:
        parent_category = AssetCategory.objects.get(id=self.parent_category_id)
        if self.category_level != parent_category.category_level + 1:
            raise ValidationError("Category level must be parent level + 1")
    else:
        if self.category_level != 1:
            raise ValidationError("Root categories must have level 1")

def clean_useful_life_years(self):
    """
    Validate useful life years
    """
    if self.useful_life_years and self.useful_life_years < 0:
        raise ValidationError("Useful life years must be positive")
    
    if self.useful_life_years and self.useful_life_years > 50:
        raise ValidationError("Useful life years cannot exceed 50 years")

def clean_salvage_value_percentage(self):
    """
    Validate salvage value percentage
    """
    if self.salvage_value_percentage and (
        self.salvage_value_percentage < 0 or self.salvage_value_percentage > 100
    ):
        raise ValidationError("Salvage value percentage must be between 0 and 100")

def clean_parent_category(self):
    """
    Validate parent category to prevent circular references
    """
    if self.parent_category_id:
        # Check for circular reference
        current = self.parent_category_id
        while current:
            if current == self.id:
                raise ValidationError("Circular category reference detected")
            try:
                parent = AssetCategory.objects.get(id=current)
                current = parent.parent_category_id
            except AssetCategory.DoesNotExist:
                break
```

### **6.3 Business Constraints**
- Cannot delete asset categories with associated assets
- Cannot modify parent categories if they have child categories
- Cannot deactivate categories used in current fiscal period
- Asset classification rules must be validated before asset creation
- Depreciation methods must comply with accounting standards

--- END OF SECTION 6 ---

## **7. UI/UX SPECIFICATIONS**

### **7.1 User Interface Requirements**
- **Layout:** Hierarchical tree view with category structure and details panel
- **Navigation:** Breadcrumb navigation for category hierarchy traversal
- **Responsiveness:** Full desktop experience with tablet support for asset management

### **7.2 User Experience Design**
- **User Flow:** Browse categories → Select category → Configure rules → Test classification → Save
- **Error Handling:** Inline validation with clear error messages for category conflicts
- **Loading States:** Progress indicators for category validation and rule testing

### **7.3 Accessibility Standards**
- **WCAG Compliance:** WCAG 2.1 AA compliance
- **Keyboard Navigation:** Full keyboard accessibility for all category management controls
- **Screen Reader Support:** Comprehensive ARIA labels for complex category relationships

### **7.4 Visual Design System**
- **Design System:** Material Design 3.0
- **Component Library:** Material-UI (MUI) v5
- **Design Tokens:** Custom design token system

### **7.5 Typography Standards**
- **Primary Font Family:** 'Inter', 'Roboto', sans-serif
- **Secondary Font Family:** 'JetBrains Mono', monospace
- **Font Sizes:**
  - **H1:** 32px / 700 / 40px
  - **H2:** 24px / 600 / 32px
  - **H3:** 20px / 600 / 28px
  - **H4:** 18px / 600 / 24px
  - **H5:** 16px / 600 / 24px
  - **H6:** 14px / 600 / 20px
  - **Body Large:** 16px / 400 / 24px
  - **Body Medium:** 14px / 400 / 20px
  - **Body Small:** 12px / 400 / 16px
  - **Caption:** 11px / 400 / 16px

### **7.6 Color Palette**
- **Primary Colors:**
  - **Primary 50:** #e3f2fd
  - **Primary 100:** #bbdefb
  - **Primary 200:** #90caf9
  - **Primary 300:** #64b5f6
  - **Primary 400:** #42a5f5
  - **Primary 500:** #2196f3
  - **Primary 600:** #1e88e5
  - **Primary 700:** #1976d2
  - **Primary 800:** #1565c0
  - **Primary 900:** #0d47a1
- **Semantic Colors:**
  - **Success:** #4caf50
  - **Warning:** #ff9800
  - **Error:** #f44336
  - **Info:** #2196f3

### **7.7 Spacing System**
- **Base Unit:** 4px
- **Spacing Scale:**
  - **XS:** 4px
  - **SM:** 8px
  - **MD:** 16px
  - **LG:** 24px
  - **XL:** 32px
  - **2XL:** 48px
  - **3XL:** 64px

### **7.8 Component Standards**
- **Buttons:**
  - **Primary Button:** Height 40px, Padding 0 24px, Border-radius 8px
  - **Secondary Button:** Height 40px, Padding 0 16px, Border-radius 8px
- **Form Controls:**
  - **Text Input:** Height 56px, Padding 16px, Border-radius 8px
  - **Select Dropdown:** Height 56px, Padding 16px, Border-radius 8px

### **7.9 Filter System Standards**
- **Filter Layout:** Sidebar filter panel
- **Filter Components:** Search, category type filter, asset type filter, status filter
- **Filter Actions:** Apply, Clear, Reset buttons

### **7.10 Data Display Standards**
- **Tables:**
  - **Header Row:** Height 56px, background #f8f9fa
  - **Data Row:** Height 48px, hover background #f5f5f5
  - **Cell Padding:** 16px horizontal, 12px vertical

--- END OF SECTION 7 ---

## **8. INTEGRATION POINTS**

## **8.1 External Systems**
- **Asset Management Systems:** Integration with external asset tracking systems
- **Accounting Software:** Synchronization with external accounting packages
- **Compliance Systems:** Integration with regulatory compliance systems
- **Insurance Providers:** Integration with insurance management systems

## **8.2 Internal APIs**
- **Asset Management API:** Asset category assignment and classification integration
- **Depreciation API:** Depreciation method integration for asset categories
- **User Management API:** Role-based access control for category management
- **Audit Trail API:** Complete audit logging for all category operations

--- END OF SECTION 8 ---

## **9. API SPECIFICATIONS**

## **9.1 REST Endpoints**

#### **GET /api/asset-categories/**
- **Purpose:** Retrieve all asset categories for a company
- **Authentication:** JWT token required
- **Parameters:** company_id, parent_category_id, asset_type, is_active
- **Response:** List of asset category objects with hierarchical structure

#### **POST /api/asset-categories/**
- **Purpose:** Create new asset category
- **Authentication:** JWT token required
- **Request Body:** Asset category configuration with validation rules
- **Response:** Created asset category object with validation results

#### **GET /api/asset-categories/{id}/**
- **Purpose:** Retrieve specific asset category with full details
- **Authentication:** JWT token required
- **Parameters:** Asset category UUID
- **Response:** Complete asset category object with relationships

#### **PUT /api/asset-categories/{id}/**
- **Purpose:** Update existing asset category
- **Authentication:** JWT token required
- **Request Body:** Updated asset category configuration
- **Response:** Updated asset category object with change tracking

#### **DELETE /api/asset-categories/{id}/**
- **Purpose:** Deactivate asset category
- **Authentication:** JWT token required
- **Parameters:** Asset category UUID
- **Response:** Deactivation confirmation

#### **GET /api/depreciation-methods/**
- **Purpose:** Retrieve all depreciation methods
- **Authentication:** JWT token required
- **Parameters:** company_id, calculation_type, is_active
- **Response:** List of depreciation method objects

#### **POST /api/asset-categories/{id}/validate-asset/**
- **Purpose:** Validate asset classification against category rules
- **Authentication:** JWT token required
- **Request Body:** Asset data for validation
- **Response:** Validation results with category assignment recommendations

## **9.2 Data Formats**
- **Request Format:** JSON with proper asset category validation
- **Response Format:** JSON with standardized asset category data
- **Error Format:** JSON with asset-specific error details and validation messages

--- END OF SECTION 9 ---

## **10. SECURITY REQUIREMENTS**

## **10.1 Authentication**
- **Method:** JWT-based authentication with role-based access control
- **Authorization:** Asset category permissions (view, create, edit, delete, admin)
- **Session Management:** Secure session handling with automatic timeout

## **10.2 Data Protection**
- **Encryption:** AES-256 encryption for sensitive asset data
- **Data Masking:** Partial masking of confidential asset information in logs
- **Audit Trail:** Complete audit logging for all asset category operations

## **10.3 Access Control**
- **Permissions:**
  - asset_categories_view: View asset category configurations
  - asset_categories_create: Create new asset categories
  - asset_categories_edit: Modify existing asset categories
  - asset_categories_delete: Deactivate asset categories
  - asset_categories_admin: Full administrative access
- **Roles:** Asset Manager, Finance Controller, Accountant, Compliance Officer
- **Audit Trail:** Complete audit logging for all asset category operations

--- END OF SECTION 10 ---

## **11. PERFORMANCE CONSIDERATIONS**

## **11.1 Database Optimization**
- **Indexing Strategy:** Optimized indexes for category hierarchy queries
- **Query Optimization:** Efficient queries for asset classification and reporting
- **Connection Pooling:** Database connection management for concurrent asset operations

## **11.2 Caching Strategy**
- **Cache Layers:** Redis caching for frequently accessed asset categories
- **Cache Invalidation:** Time-based and event-driven cache invalidation for category updates
- **Performance Metrics:** Category lookup time, classification accuracy rates

--- END OF SECTION 11 ---

## **12. TESTING REQUIREMENTS**

## **12.1 Unit Tests**
- **Coverage Target:** 95% code coverage for asset category models and business logic
- **Test Framework:** pytest with Django test framework
- **Test Data:** Comprehensive test data for various asset scenarios and categories

## **12.2 Integration Tests**
- **API Testing:** Complete API endpoint testing for asset category operations
- **Database Testing:** Asset model relationship and constraint testing
- **Classification Testing:** Asset classification rule accuracy and performance validation

## **12.3 User Acceptance Tests**
- **UAT Scenarios:** End-to-end asset categorization workflows
- **User Stories:** Category setup, rule configuration, asset classification, reporting validation
- **Acceptance Criteria:** Accurate asset classification with proper depreciation method assignment

--- END OF SECTION 12 ---

## **13. DEPLOYMENT SPECIFICATIONS**

## **13.1 Environment Requirements**
- **Development:** Local development with sample asset categories
- **Staging:** Pre-production environment with full asset categorization testing
- **Production:** High-availability setup with scalable asset management capabilities

## **13.2 Configuration Management**
- **Settings:** Asset category configuration parameters and classification rules
- **Environment Variables:** API keys for external asset management systems
- **Secrets Management:** Secure storage of sensitive asset configuration data

## **13.3 Monitoring & Logging**
- **Application Logs:** Asset category operation logs with detailed audit trails
- **Performance Metrics:** Asset categorization performance and accuracy rates
- **Error Tracking:** Real-time error monitoring and alerting

--- END OF SECTION 13 ---

## **14. MAINTENANCE & SUPPORT**

## **14.1 Regular Maintenance**
- **Database Maintenance:** Monthly asset category updates and archiving
- **Performance Tuning:** Quarterly performance optimization for asset operations
- **Compliance Updates:** Regular updates to asset classification rules and accounting standards

## **14.2 Support Procedures**
- **Issue Tracking:** Ticket system integration for asset category issues
- **Knowledge Base:** Documentation for asset category management procedures
- **User Training:** Training programs for asset managers and finance staff

--- END OF SECTION 14 ---

## **15. VERSION CONTROL**

## **15.1 Version History**
- **v1.0.0:** Initial release with basic asset category management
- **v1.1.0:** Enhanced classification rules and validation frameworks
- **v1.2.0:** Advanced multi-level category hierarchies and reporting capabilities

## **15.2 Change Management**
- **Release Process:** Structured release process with backward compatibility
- **Rollback Procedures:** Emergency rollback capabilities for critical asset issues
- **Migration Scripts:** Data migration scripts for asset schema updates

--- END OF SECTION 15 ---

## **16. COMPLIANCE & AUDIT**

## **16.1 Regulatory Compliance**
- **IAS 16:** Compliance with International Accounting Standards for fixed assets
- **GAAP:** Generally Accepted Accounting Principles compliance for asset categorization
- **IFRS:** International Financial Reporting Standards for asset management
- **Tax Regulations:** Compliance with tax depreciation rules and asset classification requirements

## **16.2 Audit Requirements**
- **Audit Trail:** Complete audit trail for all asset category operations and changes
- **Compliance Reporting:** Automated generation of asset compliance reports
- **Documentation:** Comprehensive documentation for audit purposes
- **Security Controls:** Proper segregation of duties and access controls for asset data

--- END OF SECTION 16 ---

**END OF ASSET CATEGORIES BBP**
