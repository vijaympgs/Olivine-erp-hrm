# FMS BBP - Depreciation Methods

## **1. MODULE IDENTIFICATION**

**Module Name:** Depreciation Methods
**Module Number:** 4.2
**Module Type:** Master
**Target File:** FMS/04.Fixed_Assets/4.2 Depreciation Methods.md
**Created Date:** December 30, 2025
**Version:** 1.0.0
**Author:** BBP System

--- END OF SECTION 1 ---

## **2. PURPOSE**

### **2.1 Business Purpose**
The Depreciation Methods module provides comprehensive configuration and management of depreciation calculation methodologies, enabling standardized asset depreciation processing, tax compliance optimization, and accurate financial reporting across multiple depreciation schedules and accounting standards for the organization's fixed asset portfolio.

### **2.2 Business Scope**
**In Scope:**
- Depreciation method creation and configuration management
- Multiple depreciation calculation algorithms (Straight Line, Declining Balance, etc.)
- Tax and book depreciation method separation and management
- Depreciation schedule generation and period calculations
- Asset-specific depreciation parameter configuration
- Depreciation method templates and default assignments
- Integration with asset categories and asset registers
- Depreciation calculation validation and audit trails

**Out of Scope:**
- Actual asset depreciation processing (handled by Asset Depreciation module)
- Asset acquisition and disposal processing (handled by Asset modules)
- Asset maintenance and impairment processing (handled by Asset Maintenance module)
- Asset reporting and analytics (handled by Asset Reports module)
- Fixed asset register management (handled by Asset Register module)

### **2.3 Key Stakeholders**
- **Asset Managers:** Depreciation method configuration and parameter management
- **Finance Controllers:** Depreciation methodology oversight and compliance monitoring
- **Accountants:** Depreciation calculation validation and financial reporting
- **Tax Professionals:** Tax depreciation method optimization and compliance
- **External Auditors:** Depreciation methodology documentation and audit verification

--- END OF SECTION 2 ---

## **3. CORE MODELS (DJANGO)**

### **3.1 Primary Model: DepreciationMethod**

```python
class DepreciationMethod(models.Model):
    """
    Master depreciation method configuration for standardized asset depreciation calculations
    """
    
    # Primary Key
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    
    # Foreign Keys
    company_id = models.UUIDField()
    created_by_user_id = models.UUIDField()
    
    # Core Fields
    method_code = models.CharField(max_length=50)
    method_name = models.CharField(max_length=200)
    method_description = models.TextField(blank=True)
    
    # Method Classification
    method_type = models.CharField(
        max_length=30,
        choices=[
            ('BOOK', 'Book Depreciation'),
            ('TAX', 'Tax Depreciation'),
            ('BOTH', 'Book and Tax'),
            ('SPECIAL', 'Special Purpose'),
        ]
    )
    calculation_type = models.CharField(
        max_length=30,
        choices=[
            ('STRAIGHT_LINE', 'Straight Line'),
            ('DECLINING_BALANCE', 'Declining Balance'),
            ('DOUBLE_DECLINING', 'Double Declining Balance'),
            ('SUM_OF_YEARS_DIGITS', 'Sum of Years Digits'),
            ('UNITS_OF_PRODUCTION', 'Units of Production'),
            ('MACRS', 'Modified Accelerated Cost Recovery System'),
            ('ACRS', 'Accelerated Cost Recovery System'),
            ('CUSTOM', 'Custom Method'),
        ]
    )
    
    # Calculation Parameters
    calculation_formula = models.TextField(blank=True)  # JSON formula definition
    default_useful_life_years = models.IntegerField(null=True, blank=True)
    default_salvage_rate = models.DecimalField(
        max_digits=5, decimal_places=2, null=True, blank=True
    )
    default_rate_percentage = models.DecimalField(
        max_digits=8, decimal_places=4, null=True, blank=True
    )
    
    # Configuration
    is_active = models.BooleanField(default=True)
    is_system_defined = models.BooleanField(default=False)
    requires_salvage_value = models.BooleanField(default=True)
    supports_partial_year = models.BooleanField(default=True)
    supports_switch_to_straight_line = models.BooleanField(default=False)
    
    # Audit Fields
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'fms_depreciation_methods'
        verbose_name = 'Depreciation Method'
        verbose_name_plural = 'Depreciation Methods'
        indexes = [
            models.Index(fields=['company_id', 'method_code'], name='idx_dm_company_code'),
            models.Index(fields=['method_type'], name='idx_dm_type'),
            models.Index(fields=['calculation_type'], name='idx_dm_calculation'),
            models.Index(fields=['is_active'], name='idx_dm_active'),
        ]
        constraints = [
            models.UniqueConstraint(fields=['company_id', 'method_code'], name='uk_dm_company_code'),
        ]

class DepreciationRate(models.Model):
    """
    Depreciation rate configuration for different asset classes and periods
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    depreciation_method_id = models.UUIDField()
    
    # Rate Configuration
    asset_class_code = models.CharField(max_length=50)
    year_number = models.IntegerField()
    rate_percentage = models.DecimalField(max_digits=8, decimal_places=4)
    
    # Additional Parameters
    minimum_rate = models.DecimalField(max_digits=8, decimal_places=4, null=True, blank=True)
    maximum_rate = models.DecimalField(max_digits=8, decimal_places=4, null=True, blank=True)
    switch_to_sl_rate = models.DecimalField(
        max_digits=8, decimal_places=4, null=True, blank=True
    )
    
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'fms_depreciation_rates'
        verbose_name = 'Depreciation Rate'
        verbose_name_plural = 'Depreciation Rates'
        indexes = [
            models.Index(fields=['company_id', 'depreciation_method_id'], name='idx_dr_company_method'),
            models.Index(fields=['asset_class_code'], name='idx_dr_asset_class'),
            models.Index(fields=['year_number'], name='idx_dr_year'),
            models.Index(fields=['is_active'], name='idx_dr_active'),
        ]
        constraints = [
            models.UniqueConstraint(
                fields=['company_id', 'depreciation_method_id', 'asset_class_code', 'year_number'],
                name='uk_dr_unique_rate'
            ),
        ]

class DepreciationSchedule(models.Model):
    """
    Depreciation schedule templates for standard asset categories
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    depreciation_method_id = models.UUIDField()
    
    # Schedule Configuration
    schedule_name = models.CharField(max_length=200)
    schedule_description = models.TextField(blank=True)
    asset_category_id = models.UUIDField()
    
    # Schedule Parameters
    total_useful_life_years = models.IntegerField()
    convention_type = models.CharField(
        max_length=30,
        choices=[
            ('FULL_MONTH', 'Full Month'),
            ('HALF_YEAR', 'Half Year'),
            ('MID_MONTH', 'Mid Month'),
            ('MID_QUARTER', 'Mid Quarter'),
            ('FULL_YEAR', 'Full Year'),
        ]
    )
    
    # Default Values
    default_salvage_rate = models.DecimalField(
        max_digits=5, decimal_places=2, null=True, blank=True
    )
    default_first_year_convention = models.CharField(
        max_length=30,
        choices=[
            ('FULL_YEAR', 'Full Year'),
            ('HALF_YEAR', 'Half Year'),
            ('NO_DEPRECIATION', 'No Depreciation'),
        ],
        default='HALF_YEAR'
    )
    
    is_active = models.BooleanField(default=True)
    is_template = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'fms_depreciation_schedules'
        verbose_name = 'Depreciation Schedule'
        verbose_name_plural = 'Depreciation Schedules'
        indexes = [
            models.Index(fields=['company_id', 'depreciation_method_id'], name='idx_ds_company_method'),
            models.Index(fields=['asset_category_id'], name='idx_ds_category'),
            models.Index(fields=['is_active'], name='idx_ds_active'),
            models.Index(fields=['is_template'], name='idx_ds_template'),
        ]
```

--- END OF SECTION 3 ---

## **4. REFERENCE MODELS (DJANGO)**

### **4.1 Company**

```python
class Company(models.Model):
    """
    Reference to company for multi-tenant support
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_name = models.CharField(max_length=200)
    is_active = models.BooleanField(default=True)
    
    class Meta:
        db_table = 'fms_companies'
        verbose_name = 'Company'
        verbose_name_plural = 'Companies'
```

### **4.2 AssetCategory**

```python
class AssetCategory(models.Model):
    """
    Reference to asset category for depreciation method assignment
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    category_code = models.CharField(max_length=50)
    category_name = models.CharField(max_length=200)
    depreciation_method_id = models.UUIDField()
    is_active = models.BooleanField(default=True)
    
    class Meta:
        db_table = 'fms_asset_categories'
        verbose_name = 'Asset Category'
        verbose_name_plural = 'Asset Categories'
```

--- END OF SECTION 4 ---

## **5. FOREIGN KEY RELATIONSHIPS**

### **5.1 Primary Relationships**
- **DepreciationMethod** → **Company**: Multi-tenant support through company_id
- **DepreciationRate** → **DepreciationMethod**: Many-to-one relationship for rate configuration
- **DepreciationSchedule** → **DepreciationMethod**: Many-to-one relationship for schedule templates
- **DepreciationSchedule** → **AssetCategory**: Many-to-one relationship for category-specific schedules
- **AssetCategory** → **DepreciationMethod**: Many-to-one relationship for default method assignment

### **5.2 Many-to-Many Relationships**
- **DepreciationMethod** ↔ **AssetCategory**: Through asset_category_id for method assignment
- **DepreciationMethod** ↔ **DepreciationSchedule**: Through schedule templates for method configuration

--- END OF SECTION 5 ---

## **6. BUSINESS RULES & VALIDATIONS**

### **6.1 Data Integrity Rules**
- Depreciation method codes must be unique within each company
- Depreciation rates must be positive and within reasonable bounds (0-100%)
- Schedule years must be sequential and within useful life limits
- System-defined methods cannot be modified or deleted
- Active methods cannot be deleted if used by asset categories

### **6.2 Validation Logic**

```python
def clean_method_code(self):
    """
    Validate depreciation method code format and uniqueness
    """
    if not re.match(r'^[A-Z0-9]{2,50}$', self.method_code):
        raise ValidationError("Method code must be 2-50 alphanumeric characters")
    
    # Check uniqueness within company
    if DepreciationMethod.objects.filter(
        company_id=self.company_id,
        method_code=self.method_code
    ).exclude(id=self.id).exists():
        raise ValidationError("Method code must be unique within company")

def clean_default_rate_percentage(self):
    """
    Validate default rate percentage
    """
    if self.default_rate_percentage and (
        self.default_rate_percentage < 0 or self.default_rate_percentage > 100
    ):
        raise ValidationError("Default rate percentage must be between 0 and 100")

def clean_useful_life_years(self):
    """
    Validate useful life years
    """
    if self.default_useful_life_years and (
        self.default_useful_life_years < 1 or self.default_useful_life_years > 50
    ):
        raise ValidationError("Useful life years must be between 1 and 50")

def clean_salvage_rate(self):
    """
    Validate salvage value rate
    """
    if self.default_salvage_rate and (
        self.default_salvage_rate < 0 or self.default_salvage_rate > 100
    ):
        raise ValidationError("Salvage rate must be between 0 and 100")

def clean_calculation_type(self):
    """
    Validate calculation type compatibility with method type
    """
    if self.method_type == 'TAX' and self.calculation_type not in [
        'MACRS', 'ACRS', 'STRAIGHT_LINE', 'DECLINING_BALANCE'
    ]:
        raise ValidationError("Tax methods must use MACRS, ACRS, Straight Line, or Declining Balance")

def validate_depreciation_rate(self, rate_percentage, year_number):
    """
    Validate depreciation rate for specific year
    """
    if rate_percentage < 0 or rate_percentage > 100:
        raise ValidationError("Depreciation rate must be between 0 and 100")
    
    if year_number < 1:
        raise ValidationError("Year number must be positive")
```

### **6.3 Business Constraints**
- Cannot delete depreciation methods used by active assets
- Cannot modify rates for methods used in closed fiscal periods
- Tax depreciation methods must comply with local tax regulations
- Book depreciation methods must comply with accounting standards
- Depreciation schedules must have consistent year sequences

--- END OF SECTION 6 ---

## **7. UI/UX SPECIFICATIONS**

### **7.1 User Interface Requirements**
- **Layout:** Tabbed interface with method configuration, rate management, and schedule templates
- **Navigation:** Sidebar navigation with method type filtering and search capabilities
- **Responsiveness:** Full desktop experience with tablet support for configuration management

### **7.2 User Experience Design**
- **User Flow:** Select method type → Configure calculation → Set rates → Create schedules → Test calculations
- **Error Handling:** Inline validation with clear error messages for calculation conflicts
- **Loading States:** Progress indicators for depreciation calculation testing and validation

### **7.3 Accessibility Standards**
- **WCAG Compliance:** WCAG 2.1 AA compliance
- **Keyboard Navigation:** Full keyboard accessibility for all depreciation management controls
- **Screen Reader Support:** Comprehensive ARIA labels for complex calculation parameters

### **7.4 Visual Design System**
- **Design System:** Material Design 3.0
- **Component Library:** Material-UI (MUI) v5
- **Design Tokens:** Custom design token system

### **7.5 Typography Standards**
- **Primary Font Family:** 'Inter', 'Roboto', sans-serif
- **Secondary Font Family:** 'JetBrains Mono', monospace
- **Font Sizes:**
  - **H1:** 32px / 700 / 40px
  - **H2:** 24px / 600 / 32px
  - **H3:** 20px / 600 / 28px
  - **H4:** 18px / 600 / 24px
  - **H5:** 16px / 600 / 24px
  - **H6:** 14px / 600 / 20px
  - **Body Large:** 16px / 400 / 24px
  - **Body Medium:** 14px / 400 / 20px
  - **Body Small:** 12px / 400 / 16px
  - **Caption:** 11px / 400 / 16px

### **7.6 Color Palette**
- **Primary Colors:**
  - **Primary 50:** #e3f2fd
  - **Primary 100:** #bbdefb
  - **Primary 200:** #90caf9
  - **Primary 300:** #64b5f6
  - **Primary 400:** #42a5f5
  - **Primary 500:** #2196f3
  - **Primary 600:** #1e88e5
  - **Primary 700:** #1976d2
  - **Primary 800:** #1565c0
  - **Primary 900:** #0d47a1
- **Semantic Colors:**
  - **Success:** #4caf50
  - **Warning:** #ff9800
  - **Error:** #f44336
  - **Info:** #2196f3

### **7.7 Spacing System**
- **Base Unit:** 4px
- **Spacing Scale:**
  - **XS:** 4px
  - **SM:** 8px
  - **MD:** 16px
  - **LG:** 24px
  - **XL:** 32px
  - **2XL:** 48px
  - **3XL:** 64px

### **7.8 Component Standards**
- **Buttons:**
  - **Primary Button:** Height 40px, Padding 0 24px, Border-radius 8px
  - **Secondary Button:** Height 40px, Padding 0 16px, Border-radius 8px
- **Form Controls:**
  - **Text Input:** Height 56px, Padding 16px, Border-radius 8px
  - **Select Dropdown:** Height 56px, Padding 16px, Border-radius 8px

### **7.9 Filter System Standards**
- **Filter Layout:** Sidebar filter panel
- **Filter Components:** Search, method type filter, calculation type filter, status filter
- **Filter Actions:** Apply, Clear, Reset buttons

### **7.10 Data Display Standards**
- **Tables:**
  - **Header Row:** Height 56px, background #f8f9fa
  - **Data Row:** Height 48px, hover background #f5f5f5
  - **Cell Padding:** 16px horizontal, 12px vertical

--- END OF SECTION 7 ---

## **8. INTEGRATION POINTS**

## **8.1 External Systems**
- **Tax Authorities:** Integration with tax authority systems for depreciation rate updates
- **Accounting Standards Bodies:** Integration with IFRS/GAAP standard updates
- **Asset Management Systems:** Integration with external asset tracking systems
- **Financial Reporting Systems:** Integration with external reporting packages

## **8.2 Internal APIs**
- **Asset Management API:** Depreciation method assignment and calculation integration
- **Asset Category API:** Default depreciation method configuration for categories
- **User Management API:** Role-based access control for depreciation method management
- **Audit Trail API:** Complete audit logging for all depreciation method operations

--- END OF SECTION 8 ---

## **9. API SPECIFICATIONS**

## **9.1 REST Endpoints**

#### **GET /api/depreciation-methods/**
- **Purpose:** Retrieve all depreciation methods for a company
- **Authentication:** JWT token required
- **Parameters:** company_id, method_type, calculation_type, is_active
- **Response:** List of depreciation method objects with rate configurations

#### **POST /api/depreciation-methods/**
- **Purpose:** Create new depreciation method
- **Authentication:** JWT token required
- **Request Body:** Depreciation method configuration with calculation parameters
- **Response:** Created depreciation method object with validation results

#### **GET /api/depreciation-methods/{id}/**
- **Purpose:** Retrieve specific depreciation method with full details
- **Authentication:** JWT token required
- **Parameters:** Depreciation method UUID
- **Response:** Complete depreciation method object with rates and schedules

#### **PUT /api/depreciation-methods/{id}/**
- **Purpose:** Update existing depreciation method
- **Authentication:** JWT token required
- **Request Body:** Updated depreciation method configuration
- **Response:** Updated depreciation method object with change tracking

#### **DELETE /api/depreciation-methods/{id}/**
- **Purpose:** Deactivate depreciation method
- **Authentication:** JWT token required
- **Parameters:** Depreciation method UUID
- **Response:** Deactivation confirmation

#### **GET /api/depreciation-methods/{id}/rates/**
- **Purpose:** Retrieve depreciation rates for a method
- **Authentication:** JWT token required
- **Parameters:** Depreciation method UUID, asset_class_code
- **Response:** List of depreciation rate objects

#### **POST /api/depreciation-methods/{id}/rates/**
- **Purpose:** Create depreciation rate for method
- **Authentication:** JWT token required
- **Request Body:** Depreciation rate configuration
- **Response:** Created depreciation rate object

#### **POST /api/depreciation-methods/{id}/calculate/**
- **Purpose:** Test depreciation calculation for method
- **Authentication:** JWT token required
- **Request Body:** Asset data for calculation testing
- **Response:** Depreciation calculation results with period breakdown

## **9.2 Data Formats**
- **Request Format:** JSON with proper depreciation method validation
- **Response Format:** JSON with standardized depreciation method data
- **Error Format:** JSON with depreciation-specific error details and validation messages

--- END OF SECTION 9 ---

## **10. SECURITY REQUIREMENTS**

## **10.1 Authentication**
- **Method:** JWT-based authentication with role-based access control
- **Authorization:** Depreciation method permissions (view, create, edit, delete, admin)
- **Session Management:** Secure session handling with automatic timeout

## **10.2 Data Protection**
- **Encryption:** AES-256 encryption for sensitive depreciation data
- **Data Masking:** Partial masking of confidential depreciation information in logs
- **Audit Trail:** Complete audit logging for all depreciation method operations

## **10.3 Access Control**
- **Permissions:**
  - depreciation_methods_view: View depreciation method configurations
  - depreciation_methods_create: Create new depreciation methods
  - depreciation_methods_edit: Modify existing depreciation methods
  - depreciation_methods_delete: Deactivate depreciation methods
  - depreciation_methods_admin: Full administrative access
- **Roles:** Asset Manager, Finance Controller, Accountant, Tax Professional
- **Audit Trail:** Complete audit logging for all depreciation method operations

--- END OF SECTION 10 ---

## **11. PERFORMANCE CONSIDERATIONS**

## **11.1 Database Optimization**
- **Indexing Strategy:** Optimized indexes for depreciation method and rate queries
- **Query Optimization:** Efficient queries for depreciation calculation and reporting
- **Connection Pooling:** Database connection management for concurrent depreciation operations

## **11.2 Caching Strategy**
- **Cache Layers:** Redis caching for frequently accessed depreciation methods and rates
- **Cache Invalidation:** Time-based and event-driven cache invalidation for method updates
- **Performance Metrics:** Method lookup time, calculation accuracy rates

--- END OF SECTION 11 ---

## **12. TESTING REQUIREMENTS**

## **12.1 Unit Tests**
- **Coverage Target:** 95% code coverage for depreciation method models and business logic
- **Test Framework:** pytest with Django test framework
- **Test Data:** Comprehensive test data for various depreciation scenarios and methods

## **12.2 Integration Tests**
- **API Testing:** Complete API endpoint testing for depreciation method operations
- **Database Testing:** Depreciation model relationship and constraint testing
- **Calculation Testing:** Depreciation calculation accuracy and performance validation

## **12.3 User Acceptance Tests**
- **UAT Scenarios:** End-to-end depreciation method configuration workflows
- **User Stories:** Method setup, rate configuration, schedule creation, calculation testing
- **Acceptance Criteria:** Accurate depreciation calculations with proper method assignment

--- END OF SECTION 12 ---

## **13. DEPLOYMENT SPECIFICATIONS**

## **13.1 Environment Requirements**
- **Development:** Local development with sample depreciation methods
- **Staging:** Pre-production environment with full depreciation calculation testing
- **Production:** High-availability setup with scalable depreciation processing capabilities

## **13.2 Configuration Management**
- **Settings:** Depreciation method configuration parameters and calculation rules
- **Environment Variables:** API keys for external tax authority systems
- **Secrets Management:** Secure storage of sensitive depreciation configuration data

## **13.3 Monitoring & Logging**
- **Application Logs:** Depreciation method operation logs with detailed audit trails
- **Performance Metrics:** Depreciation calculation performance and accuracy rates
- **Error Tracking:** Real-time error monitoring and alerting

--- END OF SECTION 13 ---

## **14. MAINTENANCE & SUPPORT**

## **14.1 Regular Maintenance**
- **Database Maintenance:** Monthly depreciation method updates and archiving
- **Performance Tuning:** Quarterly performance optimization for depreciation calculations
- **Compliance Updates:** Regular updates to depreciation methods and tax regulations

## **14.2 Support Procedures**
- **Issue Tracking:** Ticket system integration for depreciation method issues
- **Knowledge Base:** Documentation for depreciation method management procedures
- **User Training:** Training programs for asset managers and finance staff

--- END OF SECTION 14 ---

## **15. VERSION CONTROL**

## **15.1 Version History**
- **v1.0.0:** Initial release with basic depreciation method management
- **v1.1.0:** Enhanced calculation algorithms and rate management
- **v1.2.0:** Advanced schedule templates and tax compliance features

## **15.2 Change Management**
- **Release Process:** Structured release process with backward compatibility
- **Rollback Procedures:** Emergency rollback capabilities for critical depreciation issues
- **Migration Scripts:** Data migration scripts for depreciation schema updates

--- END OF SECTION 15 ---

## **16. COMPLIANCE & AUDIT**

## **16.1 Regulatory Compliance**
- **IAS 16:** Compliance with International Accounting Standards for depreciation
- **GAAP:** Generally Accepted Accounting Principles compliance for depreciation methods
- **IFRS:** International Financial Reporting Standards for asset depreciation
- **Tax Regulations:** Compliance with local tax depreciation rules and MACRS/ACRS standards

## **16.2 Audit Requirements**
- **Audit Trail:** Complete audit trail for all depreciation method operations and changes
- **Compliance Reporting:** Automated generation of depreciation compliance reports
- **Documentation:** Comprehensive documentation for audit purposes
- **Security Controls:** Proper segregation of duties and access controls for depreciation data

--- END OF SECTION 16 ---

**END OF DEPRECIATION METHODS BBP**
