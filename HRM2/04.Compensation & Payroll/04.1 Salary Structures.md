# 1. MODULE IDENTIFICATION

**Module Name:** Salary Structures
**Module Number:** 04.1
**Module Type:** Master
**Target File:** HR/04.Compensation & Payroll/04.1 Salary Structures.md
**Created Date:** December 29, 2025
**Version:** 1.0
**Author:** HR System Architect

--- END OF SECTION 1 ---

## 2. PURPOSE

### 2.1 Business Purpose
The Salary Structures module provides a comprehensive framework for designing, managing, and maintaining compensation structures within the organization. It enables HR professionals to create competitive salary ranges, manage pay grades, implement compensation policies, and ensure equitable pay practices while supporting strategic compensation planning and budget management.

### 2.2 Business Scope
**In Scope:**
- Pay grade and salary band management
- Compensation structure design and maintenance
- Market pricing and competitive analysis
- Salary range management and min-mid-max calculations
- Geographic differentials and location-based pay
- Merit increase and promotion guidelines
- Bonus and variable compensation structures
- Equity and long-term incentive planning
- Compensation budgeting and forecasting
- Pay equity analysis and compliance reporting
- Job evaluation and leveling integration
- Salary history and compensation tracking
- Approval workflows for compensation changes
- Compensation benchmarking and market data integration

**Out of Scope:**
- Payroll processing and disbursement (handled in Payroll Run module)
- Tax calculations and deductions (handled in Tax Calculations module)
- Time tracking and attendance (handled in Time & Attendance modules)
- Benefits administration (handled in separate Benefits modules)

### 2.3 Key Stakeholders
- **HR Compensation Team:** Structure design and policy management
- **HR Business Partners:** Compensation guidance and recommendations
- **Hiring Managers:** Salary recommendations and budget planning
- **Finance Department:** Budget planning and cost analysis
- **Executive Leadership:** Compensation strategy approval
- **Compliance Officers:** Pay equity and regulatory compliance
- **Employees:** Compensation transparency and understanding

--- END OF SECTION 2 ---

## 3. CORE MODELS (DJANGO)

### 3.1 Primary Model: SalaryStructure

```python
class SalaryStructure(models.Model):
    """
    Main salary structure model for compensation management
    """
    
    # Primary Key
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    
    # Foreign Keys
    company_id = models.UUIDField()
    created_by_user_id = models.UUIDField()
    updated_by_user_id = models.UUIDField()
    
    # Structure Details
    structure_name = models.CharField(max_length=200)
    structure_code = models.CharField(max_length=50)
    structure_type = models.CharField(max_length=50, choices=[
        ('corporate', 'Corporate'),
        ('executive', 'Executive'),
        ('sales', 'Sales'),
        ('technical', 'Technical'),
        ('hourly', 'Hourly'),
        ('contract', 'Contract'),
        ('intern', 'Intern'),
        ('regional', 'Regional'),
    ], default='corporate')
    
    # Status and Validity
    status = models.CharField(max_length=20, choices=[
        ('draft', 'Draft'),
        ('active', 'Active'),
        ('pending_approval', 'Pending Approval'),
        ('approved', 'Approved'),
        ('deprecated', 'Deprecated'),
    ], default='draft')
    
    effective_date = models.DateField()
    expiry_date = models.DateField(null=True, blank=True)
    
    # Currency and Frequency
    currency = models.CharField(max_length=10, default='USD')
    pay_frequency = models.CharField(max_length=20, choices=[
        ('hourly', 'Hourly'),
        ('weekly', 'Weekly'),
        ('bi_weekly', 'Bi-Weekly'),
        ('semi_monthly', 'Semi-Monthly'),
        ('monthly', 'Monthly'),
        ('annual', 'Annual'),
    ], default='annual')
    
    # Structure Configuration
    description = models.TextField(blank=True)
    guidelines = models.TextField(blank=True)
    approval_required = models.BooleanField(default=True)
    approval_workflow = models.JSONField(default=dict, blank=True)
    
    # Market Data Integration
    market_data_source = models.CharField(max_length=200, blank=True)
    market_positioning = models.CharField(max_length=50, choices=[
        ('lag', 'Lag'),
        ('match', 'Match'),
        ('lead', 'Lead'),
    ], default='match')
    market_position_percentage = models.IntegerField(default=50)
    
    # Geographic Differentials
    geographic_differentials_enabled = models.BooleanField(default=False)
    default_geographic_differential = models.DecimalField(max_digits=5, decimal_places=2, default=1.0)
    
    # Audit Fields
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'hr_salary_structures'
        verbose_name = 'Salary Structure'
        verbose_name_plural = 'Salary Structures'
        indexes = [
            models.Index(fields=['company_id', 'status'], name='idx_structure_status'),
            models.Index(fields=['company_id', 'structure_type'], name='idx_structure_type'),
            models.Index(fields=['company_id', 'effective_date'], name='idx_structure_effective'),
        ]
        constraints = [
            models.UniqueConstraint(fields=['company_id', 'structure_code'], name='uk_structure_code'),
        ]
```

### 3.2 Supporting Model: PayGrade

```python
class PayGrade(models.Model):
    """
    Pay grades within salary structures
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    salary_structure_id = models.UUIDField()
    
    # Grade Details
    grade_code = models.CharField(max_length=50)
    grade_name = models.CharField(max_length=200)
    grade_level = models.IntegerField()
    job_family = models.CharField(max_length=100, blank=True)
    job_category = models.CharField(max_length=100, blank=True)
    
    # Salary Range
    minimum_salary = models.DecimalField(max_digits=12, decimal_places=2)
    midpoint_salary = models.DecimalField(max_digits=12, decimal_places=2)
    maximum_salary = models.DecimalField(max_digits=12, decimal_places=2)
    
    # Range Calculations
    range_spread_percentage = models.DecimalField(max_digits=5, decimal_places=2)
    midpoint_to_min_percentage = models.DecimalField(max_digits=5, decimal_places=2)
    max_to_midpoint_percentage = models.DecimalField(max_digits=5, decimal_places=2)
    
    # Positioning Guidelines
    target_positioning = models.CharField(max_length=50, choices=[
        ('minimum', 'Minimum'),
        ('quartile_1', '1st Quartile'),
        ('midpoint', 'Midpoint'),
        ('quartile_3', '3rd Quartile'),
        ('maximum', 'Maximum'),
    ], default='midpoint')
    
    target_positioning_percentage = models.DecimalField(max_digits=5, decimal_places=2, default=50.0)
    
    # Promotion and Progression
    promotion_eligible = models.BooleanField(default=True)
    promotion_to_grade = models.CharField(max_length=50, blank=True)
    merit_increase_range_min = models.DecimalField(max_digits=5, decimal_places=2, default=0.0)
    merit_increase_range_max = models.DecimalField(max_digits=5, decimal_places=2, default=5.0)
    
    # Status and Validity
    status = models.CharField(max_length=20, choices=[
        ('active', 'Active'),
        ('inactive', 'Inactive'),
        ('phased_out', 'Phased Out'),
    ], default='active')
    
    effective_date = models.DateField()
    expiry_date = models.DateField(null=True, blank=True)
    
    # Additional Configuration
    notes = models.TextField(blank=True)
    special_requirements = models.TextField(blank=True)
    
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'hr_pay_grades'
        verbose_name = 'Pay Grade'
        verbose_name_plural = 'Pay Grades'
        indexes = [
            models.Index(fields=['company_id', 'salary_structure_id'], name='idx_grade_structure'),
            models.Index(fields=['company_id', 'grade_level'], name='idx_grade_level'),
            models.Index(fields=['company_id', 'status'], name='idx_grade_status'),
        ]
        constraints = [
            models.UniqueConstraint(fields=['company_id', 'salary_structure_id', 'grade_code'], name='uk_grade_code'),
        ]
```

### 3.3 Supporting Model: CompensationRange

```python
class CompensationRange(models.Model):
    """
    Detailed compensation ranges with geographic and other differentials
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    pay_grade_id = models.UUIDField()
    
    # Range Details
    range_name = models.CharField(max_length=200)
    range_type = models.CharField(max_length=50, choices=[
        ('base', 'Base Salary'),
        ('total_cash', 'Total Cash'),
        ('total_compensation', 'Total Compensation'),
        ('bonus_target', 'Bonus Target'),
        ('equity_value', 'Equity Value'),
    ], default='base')
    
    # Geographic Differential
    geographic_area = models.CharField(max_length=200)
    geographic_differential = models.DecimalField(max_digits=5, decimal_places=2, default=1.0)
    city = models.CharField(max_length=100, blank=True)
    state = models.CharField(max_length=100, blank=True)
    country = models.CharField(max_length=100, blank=True)
    
    # Adjusted Salary Range
    adjusted_minimum = models.DecimalField(max_digits=12, decimal_places=2)
    adjusted_midpoint = models.DecimalField(max_digits=12, decimal_places=2)
    adjusted_maximum = models.DecimalField(max_digits=12, decimal_places=2)
    
    # Market Data
    market_minimum = models.DecimalField(max_digits=12, decimal_places=2, null=True, blank=True)
    market_midpoint = models.DecimalField(max_digits=12, decimal_places=2, null=True, blank=True)
    market_maximum = models.DecimalField(max_digits=12, decimal_places=2, null=True, blank=True)
    
    # Data Source and Date
    market_data_source = models.CharField(max_length=200, blank=True)
    market_data_date = models.DateField(null=True, blank=True)
    
    # Status
    status = models.CharField(max_length=20, choices=[
        ('active', 'Active'),
        ('inactive', 'Inactive'),
        ('pending_review', 'Pending Review'),
    ], default='active')
    
    effective_date = models.DateField()
    expiry_date = models.DateField(null=True, blank=True)
    
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'hr_compensation_ranges'
        verbose_name = 'Compensation Range'
        verbose_name_plural = 'Compensation Ranges'
        indexes = [
            models.Index(fields=['company_id', 'pay_grade_id'], name='idx_range_grade'),
            models.Index(fields=['company_id', 'geographic_area'], name='idx_range_geo'),
            models.Index(fields=['company_id', 'range_type'], name='idx_range_type'),
        ]
```

--- END OF SECTION 3 ---

## 4. REFERENCE MODELS (DJANGO)

### 4.1 JobLevel

```python
class JobLevel(models.Model):
    """
    Job levels for compensation mapping
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    level_code = models.CharField(max_length=50)
    level_name = models.CharField(max_length=200)
    level_number = models.IntegerField()
    description = models.TextField(blank=True)
    is_active = models.BooleanField(default=True)
    
    class Meta:
        db_table = 'hr_job_levels'
        verbose_name = 'Job Level'
        verbose_name_plural = 'Job Levels'
```

### 4.2 MarketData

```python
class MarketData(models.Model):
    """
    Market benchmarking data
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    survey_name = models.CharField(max_length=200)
    survey_provider = models.CharField(max_length=200)
    job_family = models.CharField(max_length=100)
    job_level = models.CharField(max_length=100)
    geographic_area = models.CharField(max_length=200)
    percentile_25 = models.DecimalField(max_digits=12, decimal_places=2)
    percentile_50 = models.DecimalField(max_digits=12, decimal_places=2)
    percentile_75 = models.DecimalField(max_digits=12, decimal_places=2)
    effective_date = models.DateField()
    
    class Meta:
        db_table = 'hr_market_data'
        verbose_name = 'Market Data'
        verbose_name_plural = 'Market Data'
```

--- END OF SECTION 4 ---

## 5. FOREIGN KEY RELATIONSHIPS

### 5.1 Primary Relationships
- **SalaryStructure** → **Company**: Company ownership
- **PayGrade** → **SalaryStructure**: Grades within structure
- **CompensationRange** → **PayGrade**: Ranges for specific grades
- **JobLevel** → **PayGrade**: Job level mapping

### 5.2 Many-to-Many Relationships
- **SalaryStructure** ↔ **PayGrade**: One-to-many relationship
- **PayGrade** ↔ **CompensationRange**: One-to-many relationship

--- END OF SECTION 5 ---

## 6. BUSINESS RULES & VALIDATIONS

### 6.1 Data Integrity Rules
- Structure codes must be unique within company
- Grade codes must be unique within structure
- Minimum salary must be less than midpoint, which must be less than maximum
- Geographic differentials must be positive values
- Effective dates cannot overlap for active structures

### 6.2 Validation Logic
```python
def clean_salary_range(self):
    """
    Validate salary range logic
    """
    if self.minimum_salary >= self.midpoint_salary:
        raise ValidationError("Minimum salary must be less than midpoint salary")
    
    if self.midpoint_salary >= self.maximum_salary:
        raise ValidationError("Midpoint salary must be less than maximum salary")

def clean_geographic_differential(self):
    """
    Validate geographic differential is positive
    """
    if self.geographic_differential and self.geographic_differential <= 0:
        raise ValidationError("Geographic differential must be positive")

def clean_effective_date(self):
    """
    Validate effective date is not in the past for new structures
    """
    if self.effective_date and self.effective_date < timezone.now().date():
        if not self.pk:  # New structure
            raise ValidationError("Effective date cannot be in the past")
```

### 6.3 Business Constraints
- Maximum range spread: 200%
- Minimum range spread: 20%
- Maximum geographic differential: 2.0x
- Minimum geographic differential: 0.5x

--- END OF SECTION 6 ---

## 7. UI/UX SPECIFICATIONS

### 7.1 User Interface Requirements
- **Layout:** Dashboard with structure overview and detailed views
- **Navigation:** Tabbed interface for structure components
- **Responsiveness:** Mobile-optimized for compensation management
- **Views:** HR view, Manager view, Executive view

### 7.2 User Experience Design
- **User Flow:** Create structure → Define grades → Set ranges → Apply differentials → Approve
- **Error Handling:** Clear validation messages and error recovery
- **Loading States:** Progress indicators for complex calculations
- **Bulk Actions:** Mass updates for salary ranges and grades

### 7.3 Accessibility Standards
- **WCAG Compliance:** WCAG 2.1 AA
- **Keyboard Navigation:** Full keyboard accessibility
- **Screen Reader Support:** Proper ARIA labels and semantic HTML

### 7.4 Visual Design System
- **Color Scheme:** Professional colors with status indicators
- **Typography:** Clear, readable fonts for financial data
- **Iconography:** Intuitive icons for compensation actions

--- END OF SECTION 7 ---

## 8. INTEGRATION POINTS

### 8.1 External Systems
- **Market Data Providers:** Salary.com, Payscale, Radford APIs
- **Survey Providers:** Mercer, Willis Towers Watson integrations
- **HRIS Systems:** Workday, SAP SuccessFactors for job data
- **Financial Systems:** ERP integration for budget management
- **Compliance Tools:** Pay equity analysis software integration

### 8.2 Internal APIs
- **Employee Management API:** Employee assignment to grades
- **Job Management API:** Job level and family mapping
- **Payroll API:** Salary data for payroll processing
- **Budgeting API:** Compensation budget planning
- **Reporting API:** Compensation analytics and reporting

--- END OF SECTION 8 ---

## 9. API SPECIFICATIONS

### 9.1 REST Endpoints

#### **GET /api/salary-structures/**
- **Purpose:** Retrieve salary structures list
- **Authentication:** JWT token required
- **Parameters:** 
  - `structure_type` (string): Filter by structure type
  - `status` (string): Filter by status
  - `effective_date` (date): Filter by effective date
- **Response:** Paginated list of salary structures

#### **POST /api/salary-structures/**
- **Purpose:** Create new salary structure
- **Authentication:** JWT token required
- **Request Body:** Salary structure configuration
- **Response:** Created salary structure object

#### **GET /api/salary-structures/{structure_id}/**
- **Purpose:** Retrieve specific salary structure details
- **Authentication:** JWT token required
- **Parameters:** `structure_id` (UUID)
- **Response:** Complete salary structure with grades and ranges

#### **PUT /api/salary-structures/{structure_id}/**
- **Purpose:** Update salary structure
- **Authentication:** JWT token with appropriate permissions
- **Request Body:** Updated salary structure data
- **Response:** Updated salary structure object

#### **POST /api/salary-structures/{structure_id}/grades/**
- **Purpose:** Add pay grade to structure
- **Authentication:** JWT token required
- **Request Body:** Pay grade configuration
- **Response:** Created pay grade object

#### **GET /api/salary-structures/{structure_id}/ranges/**
- **Purpose:** Retrieve compensation ranges for structure
- **Authentication:** JWT token required
- **Parameters:** `geographic_area` (string): Filter by location
- **Response:** List of compensation ranges

#### **POST /api/salary-structures/market-analysis/**
- **Purpose:** Perform market analysis and benchmarking
- **Authentication:** JWT token required
- **Request Body:** Market analysis parameters
- **Response:** Market analysis results and recommendations

### 9.2 Data Formats
- **Request Format:** JSON
- **Response Format:** JSON
- **Error Format:** Standardized error response with validation details

--- END OF SECTION 9 ---

## 10. SECURITY REQUIREMENTS

### 10.1 Authentication
- **Method:** JWT-based authentication with role-based access
- **Authorization:** Compensation access based on user role and permissions
- **Session Management:** Secure session handling with timeout

### 10.2 Data Protection
- **Encryption:** Encrypted storage for sensitive compensation data
- **Privacy Controls:** Salary confidentiality and access restrictions
- **Data Masking:** Salary masking for unauthorized viewers

### 10.3 Access Control
- **Permissions:**
  - **Compensation Admin:** Full access to all compensation data
  - **HR Business Partner:** Access to assigned business unit data
  - **Hiring Manager:** Access to salary ranges for hiring decisions
  - **Employee:** Access to own compensation information only
- **Audit Trail:** Complete audit logging for all compensation changes

--- END OF SECTION 10 ---

## 11. PERFORMANCE CONSIDERATIONS

### 11.1 Database Optimization
- **Indexing Strategy:** Optimized indexes on structure codes and grades
- **Query Optimization:** Efficient compensation data retrieval
- **Connection Pooling:** Database connection management

### 11.2 Caching Strategy
- **Cache Layers:** Redis for frequently accessed compensation data
- **Cache Invalidation:** Smart cache invalidation on structure updates
- **Performance Metrics:** Sub-300ms response time for compensation operations

--- END OF SECTION 11 ---

## 12. TESTING REQUIREMENTS

### 12.1 Unit Tests
- **Coverage Target:** 85%
- **Test Framework:** pytest with Django test extensions
- **Test Data:** Factory Boy for comprehensive test data generation

### 12.2 Integration Tests
- **API Testing:** Complete API endpoint testing
- **Market Data Testing:** Third-party data integration validation
- **Calculation Testing:** Salary range calculation accuracy

### 12.3 User Acceptance Tests
- **UAT Scenarios:** Complete compensation structure workflows
- **Cross-browser Testing:** Compatibility across major browsers
- **Mobile Testing:** Responsive design validation

--- END OF SECTION 12 ---

## 13. DEPLOYMENT SPECIFICATIONS

### 13.1 Environment Requirements
- **Development:** Local development with mock market data
- **Staging:** Full integration testing with market data providers
- **Production:** Scalable cloud infrastructure with secure integrations

### 13.2 Configuration Management
- **Settings:** Environment-specific configuration
- **API Keys:** Secure management of third-party API credentials
- **Security Settings:** Production security hardening

--- END OF SECTION 13 ---

## 14. MAINTENANCE & SUPPORT

### 14.1 Regular Maintenance
- **Data Updates:** Regular market data updates and reviews
- **Performance Monitoring:** Compensation system performance tracking
- **Security Updates:** Regular security patching

### 14.2 Support Procedures
- **User Support:** Help desk integration for compensation issues
- **Documentation:** Comprehensive user guides and API documentation
- **Training:** Regular training sessions for HR compensation teams

--- END OF SECTION 14 ---

## 15. VERSION CONTROL

### 15.1 Version History
- **v1.0.0:** Initial release with basic structure management
- **v1.1.0:** Enhanced market data integration and analytics
- **v1.2.0:** Advanced pay equity analysis and reporting

### 15.2 Change Management
- **Release Process:** Structured release with rollback capability
- **Migration Scripts:** Database migration handling
- **Feature Flags:** Gradual feature rollout capability

--- END OF SECTION 15 ---

## 16. COMPLIANCE & AUDIT

### 16.1 Regulatory Compliance
- **Pay Equity:** Equal pay compliance and reporting
- **FLSA Compliance:** Fair Labor Standards Act adherence
- **State Laws:** State-specific compensation law compliance
- **International Compliance:** Local compensation regulations

### 16.2 Audit Requirements
- **Audit Trail:** Complete change history logging
- **Pay Equity Reports:** Automated pay equity analysis
- **Access Logging:** Comprehensive access audit logging
- **Reporting:** Automated compliance reporting generation

--- END OF SECTION 16 ---

**END OF BBP TEMPLATE**
