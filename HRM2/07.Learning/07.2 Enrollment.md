# 1. MODULE IDENTIFICATION

**Module Name:** Enrollment
**Module Number:** 07.2
**Module Type:** Transaction
**Target File:** HR/07.Learning\07.2 Enrollment.md
**Created Date:** December 29, 2025
**Version:** 1.0
**Author:** HR System Architect

--- END OF SECTION 1 ---

## 2. PURPOSE

### 2.1 Business Purpose
The Enrollment module provides a comprehensive system for managing employee course registrations, waitlists, and enrollment workflows. It enables HR departments to automate enrollment processes, manage course capacity, track enrollment status, and provide employees with self-service enrollment capabilities while ensuring compliance with training requirements and budget constraints.

### 2.2 Business Scope
**In Scope:**
- Employee course enrollment and registration
- Waitlist management and notification
- Enrollment approval workflows
- Capacity management and conflict resolution
- Self-service enrollment portal
- Bulk enrollment for group training
- Enrollment deadline and scheduling
- Prerequisite validation and checking
- Cost allocation and budget tracking
- Enrollment analytics and reporting
- Mobile enrollment access
- Integration with HRIS and LMS systems
- Compliance training enrollment
- Manager approval workflows
- Enrollment cancellation and refunds
- Learning path enrollment

**Out of Scope:**
- Course creation and management (handled in Course Catalog module)
- Completion tracking and certification (handled in Completion Tracking module)
- Content delivery and access management
- Assessment and testing functionality

### 2.3 Key Stakeholders
- **HR Department:** Enrollment process management and oversight
- **Training Managers:** Enrollment coordination and approval
- **Managers:** Team enrollment approval and budget management
- **Employees:** Course discovery and self-enrollment
- **Finance Department:** Cost allocation and budget tracking
- **Compliance Officers:** Mandatory training enrollment compliance

--- END OF SECTION 2 ---

## 3. CORE MODELS (DJANGO)

### 3.1 Primary Model: Enrollment

```python
class Enrollment(models.Model):
    """
    Main enrollment model for course registration
    """
    
    # Primary Key
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    
    # Foreign Keys
    company_id = models.UUIDField()
    employee_id = models.UUIDField()
    course_id = models.UUIDField()
    course_session_id = models.UUIDField(null=True, blank=True)
    created_by_user_id = models.UUIDField()
    updated_by_user_id = models.UUIDField()
    
    # Enrollment Details
    enrollment_number = models.CharField(max_length=50)
    enrollment_date = models.DateTimeField(auto_now_add=True)
    
    # Status Management
    status = models.CharField(max_length=20, choices=[
        ('pending', 'Pending'),
        ('confirmed', 'Confirmed'),
        ('waitlisted', 'Waitlisted'),
        ('active', 'Active'),
        ('completed', 'Completed'),
        ('cancelled', 'Cancelled'),
        ('dropped', 'Dropped'),
        ('expired', 'Expired'),
        ('suspended', 'Suspended'),
    ], default='pending')
    
    # Enrollment Type
    enrollment_type = models.CharField(max_length=50, choices=[
        ('self_enrollment', 'Self Enrollment'),
        ('manager_assigned', 'Manager Assigned'),
        ('hr_assigned', 'HR Assigned'),
        ('bulk_enrollment', 'Bulk Enrollment'),
        ('mandatory', 'Mandatory Training'),
        ('compliance', 'Compliance Required'),
        ('learning_path', 'Learning Path'),
    ])
    
    # Priority and Urgency
    priority = models.CharField(max_length=20, choices=[
        ('low', 'Low'),
        ('medium', 'Medium'),
        ('high', 'High'),
        ('urgent', 'Urgent'),
    ], default='medium')
    
    # Cost and Budget
    cost = models.DecimalField(max_digits=10, decimal_places=2, default=0)
    currency = models.CharField(max_length=10, default='USD')
    budget_code = models.CharField(max_length=50, blank=True)
    cost_center = models.CharField(max_length=100, blank=True)
    
    # Schedule Information
    start_date = models.DateField(null=True, blank=True)
    end_date = models.DateField(null=True, blank=True)
    estimated_hours = models.DecimalField(max_digits=6, decimal_places=2, null=True, blank=True)
    
    # Progress Tracking
    progress_percentage = models.IntegerField(default=0)
    completion_date = models.DateTimeField(null=True, blank=True)
    last_access_date = models.DateTimeField(null=True, blank=True)
    
    # Approval Information
    manager_approval_required = models.BooleanField(default=False)
    manager_approval_date = models.DateTimeField(null=True, blank=True)
    manager_approval_id = models.UUIDField(null=True, blank=True)
    
    # Waitlist Information
    waitlist_position = models.IntegerField(null=True, blank=True)
    waitlist_date = models.DateTimeField(null=True, blank=True)
    waitlist_notification_sent = models.BooleanField(default=False)
    
    # Cancellation Information
    cancellation_date = models.DateTimeField(null=True, blank=True)
    cancellation_reason = models.TextField(blank=True)
    refund_eligible = models.BooleanField(default=False)
    refund_amount = models.DecimalField(max_digits=10, decimal_places=2, null=True, blank=True)
    
    # Notes and Comments
    employee_notes = models.TextField(blank=True)
    admin_notes = models.TextField(blank=True)
    
    # Audit Fields
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'hr_enrollments'
        verbose_name = 'Enrollment'
        verbose_name_plural = 'Enrollments'
        indexes = [
            models.Index(fields=['company_id', 'employee_id'], name='idx_enrollment_employee'),
            models.Index(fields=['company_id', 'course_id'], name='idx_enrollment_course'),
            models.Index(fields=['company_id', 'status'], name='idx_enrollment_status'),
            models.Index(fields=['company_id', 'enrollment_date'], name='idx_enrollment_date'),
        ]
        constraints = [
            models.UniqueConstraint(fields=['company_id', 'enrollment_number'], name='uk_enrollment_number'),
        ]
```

### 3.2 Supporting Model: EnrollmentWaitlist

```python
class EnrollmentWaitlist(models.Model):
    """
    Waitlist management for course enrollments
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    course_id = models.UUIDField()
    employee_id = models.UUIDField()
    
    # Waitlist Details
    waitlist_position = models.IntegerField()
    waitlist_date = models.DateTimeField(auto_now_add=True)
    notification_sent = models.BooleanField(default=False)
    notification_date = models.DateTimeField(null=True, blank=True)
    
    # Status
    status = models.CharField(max_length=20, choices=[
        ('active', 'Active'),
        ('expired', 'Expired'),
        ('enrolled', 'Enrolled'),
        ('cancelled', 'Cancelled'),
    ], default='active')
    
    # Contact Information
    notification_email = models.EmailField(blank=True)
    notification_phone = models.CharField(max_length=50, blank=True)
    
    # Preferences
    preferred_session_times = models.JSONField(default=list, blank=True)
    preferred_location = models.CharField(max_length=200, blank=True)
    
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'hr_enrollment_waitlists'
        verbose_name = 'Enrollment Waitlist'
        verbose_name_plural = 'Enrollment Waitlists'
        indexes = [
            models.Index(fields=['company_id', 'course_id'], name='idx_waitlist_course'),
            models.Index(fields=['company_id', 'employee_id'], name='idx_waitlist_employee'),
            models.Index(fields=['company_id', 'status'], name='idx_waitlist_status'),
        ]
```

### 3.3 Supporting Model: EnrollmentApproval

```python
class EnrollmentApproval(models.Model):
    """
    Enrollment approval workflow tracking
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    enrollment_id = models.UUIDField()
    approver_id = models.UUIDField()
    
    # Approval Details
    approval_type = models.CharField(max_length=50, choices=[
        ('manager', 'Manager Approval'),
        ('hr', 'HR Approval'),
        ('budget', 'Budget Approval'),
        ('capacity', 'Capacity Approval'),
        ('compliance', 'Compliance Approval'),
    ])
    
    # Approval Decision
    decision = models.CharField(max_length=20, choices=[
        ('pending', 'Pending'),
        ('approved', 'Approved'),
        ('rejected', 'Rejected'),
        ('returned', 'Returned'),
        ('escalated', 'Escalated'),
    ], default='pending')
    
    # Approval Date
    decision_date = models.DateTimeField(null=True, blank=True)
    
    # Comments and Reason
    approver_comments = models.TextField(blank=True)
    rejection_reason = models.TextField(blank=True)
    
    # Audit Fields
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'hr_enrollment_approvals'
        verbose_name = 'Enrollment Approval'
        verbose_name_plural = 'Enrollment Approvals'
        indexes = [
            models.Index(fields=['company_id', 'enrollment_id'], name='idx_approval_enrollment'),
            models.Index(fields=['company_id', 'approver_id'], name='idx_approval_approver'),
        ]
```

--- END OF SECTION 3 ---

## 4. REFERENCE MODELS (DJANGO)

### 4.1 EnrollmentRule

```python
class EnrollmentRule(models.Model):
    """
    Enrollment rules and business logic
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    
    rule_name = models.CharField(max_length=200)
    rule_type = models.CharField(max_length=50)
    rule_conditions = models.JSONField(default=dict)
    rule_actions = models.JSONField(default=dict)
    is_active = models.BooleanField(default=True)
    
    class Meta:
        db_table = 'hr_enrollment_rules'
        verbose_name = 'Enrollment Rule'
        verbose_name_plural = 'Enrollment Rules'
```

### 4.2 EnrollmentTemplate

```python
class EnrollmentTemplate(models.Model):
    """
    Enrollment templates for bulk operations
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    
    template_name = models.CharField(max_length=200)
    template_type = models.CharField(max_length=50)
    template_criteria = models.JSONField(default=dict)
    
    is_active = models.BooleanField(default=True)
    
    class Meta:
        db_table = 'hr_enrollment_templates'
        verbose_name = 'Enrollment Template'
        verbose_name_plural = 'Enrollment Templates'
```

--- END OF SECTION 4 ---

## 5. FOREIGN KEY RELATIONSHIPS

### 5.1 Primary Relationships
- **Enrollment** → **Employee**: Employee enrollment
- **Enrollment** → **Course**: Course being enrolled in
- **Enrollment** → **CourseSession**: Specific session enrollment
- **EnrollmentWaitlist** → **Enrollment**: Waitlist for enrollment
- **EnrollmentApproval** → **Enrollment**: Approval for enrollment

### 5.2 Many-to-Many Relationships
- **Enrollment** ↔ **EnrollmentApproval**: One-to-many relationship
- **Enrollment** ↔ **EnrollmentWaitlist**: One-to-many relationship

--- END OF SECTION 5 ---

## 6. BUSINESS RULES & VALIDATIONS

### 6.1 Data Integrity Rules
- Enrollment numbers must be unique within company
- Waitlist positions must be sequential
- Enrollment dates must be valid
- Approval workflows must follow proper sequence
- Capacity constraints must be enforced

### 6.2 Validation Logic
```python
def clean_enrollment_dates(self):
    """
    Validate enrollment date logic
    """
    if self.start_date and self.end_date:
        if self.start_date > self.end_date:
            raise ValidationError("Start date must be before end date")

def clean_waitlist_position(self):
    """
    Validate waitlist position
    """
    if self.waitlist_position and self.waitlist_position < 1:
        raise ValidationError("Waitlist position must be positive")

def clean_cost_amount(self):
    """
    Validate enrollment cost
    """
    if self.cost and self.cost < 0:
        raise ValidationError("Cost cannot be negative")
```

### 6.3 Business Constraints
- Maximum waitlist size: 100 participants
- Maximum enrollment duration: 365 days
- Minimum approval time: 24 hours
- Maximum refund period: 30 days

--- END OF SECTION 6 ---

## 7. UI/UX SPECIFICATIONS

### 7.1 User Interface Requirements
- **Layout:** Dashboard with enrollment overview and management tools
- **Navigation:** Category-based browsing and search functionality
- **Responsiveness:** Mobile-optimized for enrollment access
- **Views:** Employee view, Manager view, HR view

### 7.2 User Experience Design
- **User Flow:** Browse courses → Check availability → Enroll → Get confirmation → Start learning
- **Error Handling:** Clear validation messages and error recovery
- **Waitlist Management:** Automatic waitlist notifications
- **Bulk Operations:** Mass enrollment for team training

### 7.3 Accessibility Standards
- **WCAG Compliance:** WCAG 2.1 AA
- **Keyboard Navigation:** Full keyboard accessibility
- **Screen Reader Support:** Proper ARIA labels and semantic HTML

### 7.4 Visual Design System
- **Color Scheme:** Status-based color coding for enrollment status
- **Typography:** Clear, readable fonts for enrollment information
- **Iconography:** Intuitive icons for enrollment actions and statuses

--- END OF SECTION 7 ---

## 8. INTEGRATION POINTS

### 8.1 External Systems
- **HRIS Systems:** Employee data synchronization
- **LMS Platforms:** Learning management system integration
- **Payment Systems:** Course payment processing
- **Email Systems:** Enrollment notifications and communications
- **Calendar Systems**: Schedule synchronization

### 8.2 Internal APIs
- **Course Catalog API:** Course information and availability
- **Employee Management API:** Employee data and permissions
- **Completion Tracking API:** Learning progress data
- **Notification API:** Enrollment notifications and alerts
- **Reporting API:** Enrollment analytics and metrics

--- END OF SECTION 8 ---

## 9. API SPECIFICATIONS

### 9.1 REST Endpoints

#### **GET /api/enrollments/**
- **Purpose:** Retrieve enrollments list
- **Authentication:** JWT token required
- **Parameters**: 
  - `employee_id` (UUID): Filter by employee
  - `course_id` (UUID): Filter by course
  - `status` (string): Filter by status
- **Response:** Paginated list of enrollments

#### **POST /api/enrollments/**
- **Purpose:** Create new enrollment
- **Authentication:** JWT token required
- **Request Body:** Enrollment configuration
- **Response:** Created enrollment object

#### **GET /api/enrollments/{enrollment_id}/**
- **Purpose:** Retrieve specific enrollment details
- **Authentication:** JWT token required
- **Parameters:** `enrollment_id` (UUID)
- **Response:** Complete enrollment object

#### **PUT /api/enrollments/{enrollment_id}/**
- **Purpose:** Update enrollment
- **Authentication:** JWT token with appropriate permissions
- **Request Body:** Updated enrollment data
- **Response:** Updated enrollment object

#### **POST /api/enrollments/{enrollment_id}/cancel/**
- **Purpose:** Cancel enrollment
- **Authentication:** JWT token required
- **Request Body:** Cancellation details
- **Response:** Updated enrollment status

#### **POST /api/enrollments/{enrollment_id}/complete/**
- **Purpose:** Mark enrollment as completed
- **Authentication:** JWT token required
- **Response:** Updated enrollment status

#### **GET /api/enrollments/my-enrollments/**
- **Purpose:** Retrieve current user's enrollments
- **Authentication:** JWT token required
- **Response:** List of user's enrollments

#### **POST /api/enrollments/bulk/**
- **Purpose:** Bulk enrollment for multiple employees
- **Authentication:** JWT token required
- **Request Body:** Bulk enrollment data
- **Response:** Bulk enrollment results

#### **GET /api/enrollments/waitlist/{course_id}/**
- **Purpose:** Get waitlist for course
- **Authentication:** JWT token required
- **Response:** Waitlist entries

#### **POST /api/enrollments/{enrollment_id}/approve/**
- **Purpose:** Approve enrollment
- **Authentication:** JWT token with approval permissions
- **Request Body:** Approval details
- **Response:** Updated enrollment status

### 9.2 Data Formats
- **Request Format:** JSON
- **Response Format:** JSON
- **Error Format:** Standardized error response with validation details

--- END OF SECTION 9 ---

## 10. SECURITY REQUIREMENTS

### 10.1 Authentication
- **Method:** JWT-based authentication with role-based access
- **Authorization:** Enrollment access based on user role and relationship
- **Session Management:** Secure session handling with timeout

### 10.2 Data Protection
- **Encryption:** Encrypted storage for sensitive enrollment data
- **Privacy Controls:** Enrollment data privacy and access restrictions
- **Data Masking**: Sensitive information masking for unauthorized viewers

### 10.3 Access Control
- **Permissions:**
  - **Employee:** Self-enrollment for available courses
  - **Manager:** Team enrollment management and approval
  - **Training Admin:** Full access to enrollment management
  - **HR Admin:** Full access to all enrollments and settings
- **Audit Trail:** Complete audit logging for all enrollment changes

--- END OF SECTION 10 ---

## 11. PERFORMANCE CONSIDERATIONS

### 11.1 Database Optimization
- **Indexing Strategy:** Optimized indexes on employee IDs and course IDs
- **Query Optimization:** Efficient enrollment data retrieval with proper joins
- **Connection Pooling:** Database connection management for high-volume enrollments

### 11.2 Caching Strategy
- **Cache Layers:** Redis for frequently accessed enrollment data
- **Cache Invalidation:** Smart cache invalidation on enrollment updates
- **Performance Metrics:** Sub-300ms response time for enrollment operations

--- END OF SECTION 11 ---

## 12. TESTING REQUIREMENTS

### 12.1 Unit Tests
- **Coverage Target:** 85%
- **Test Framework:** pytest with Django test extensions
- **Test Data:** Factory Boy for comprehensive test data generation

### 12.2 Integration Tests
- **API Testing:** Complete API endpoint testing
- **HRIS Integration Testing:** Employee data synchronization validation
- **LMS Integration Testing:** Learning platform integration validation

### 12.3 User Acceptance Tests
- **UAT Scenarios:** Complete enrollment workflows
- **Cross-browser Testing:** Compatibility across major browsers
- **Mobile Testing:** Responsive design validation

--- END OF SECTION 12 ---

## 13. DEPLOYMENT SPECIFICATIONS

### 13.1 Environment Requirements
- **Development:** Local development with mock data
- **Staging:** Full integration testing with HRIS and LMS
- **Production:** Scalable cloud infrastructure with secure integrations

### 13.2 Configuration Management
- **Settings:** Environment-specific configuration
- **API Keys:** Secure management of external service credentials
- **Security Settings:** Production security hardening

--- END OF SECTION 13 ---

## 14. MAINTENANCE & SUPPORT

### 14.1 Regular Maintenance
- **Data Cleanup:** Regular archiving of historical enrollment data
- **Performance Monitoring:** Enrollment system performance tracking
- **Security Updates:** Regular security patching

### 14.2 Support Procedures
- **User Support:** Help desk integration for enrollment issues
- **Documentation:** Comprehensive user guides and API documentation
- **Training:** Regular training sessions for administrators

--- END OF SECTION 14 ---

## 15. VERSION CONTROL

### 15.1 Version History
- **v1.0.0:** Initial release with basic enrollment functionality
- **v1.1.0:** Enhanced mobile app and self-service features
- **v1.2.0:** Advanced analytics and reporting features

### 15.2 Change Management
- **Release Process:** Structured release with rollback capability
- **Migration Scripts:** Database migration handling
- **Feature Flags:** Gradual feature rollout capability

--- END OF SECTION 15 ---

## 16. COMPLIANCE & AUDIT

### 16.1 Regulatory Compliance
- **Data Privacy:** Enrollment data privacy and access compliance
- **Accessibility:** ADA compliance for enrollment systems
- **Training Standards:** Industry standard compliance for training systems
- **Audit Requirements**: Complete audit trail maintenance

### 16.2 Audit Requirements
- **Audit Trail:** Complete change history logging for all enrollment changes
- **Enrollment Reports:** Automated generation of required reports
- **Access Logging**: Comprehensive access audit logging
- **Compliance Reports:** Automated compliance reporting and validation

--- END OF SECTION 16 ---

**END OF BBP TEMPLATE**
