# 1. MODULE IDENTIFICATION

**Module Name:** Clock-In-Out
**Module Number:** 05.1
**Module Type:** Transaction
**Target File:** HR/05.Time & Attendance/05.1 Clock-In-Out.md
**Created Date:** December 29, 2025
**Version:** 1.0
**Author:** HR System Architect

--- END OF SECTION 1 ---

## 2. PURPOSE

### 2.1 Business Purpose
The Clock-In-Out module provides a comprehensive system for tracking employee work hours, managing attendance, and recording time entries. It enables organizations to accurately capture employee time data, enforce attendance policies, calculate overtime, and integrate with payroll systems while providing real-time visibility into workforce presence and productivity.

### 2.2 Business Scope
**In Scope:**
- Employee clock-in and clock-out functionality
- Multiple clock-in methods (web, mobile, kiosk, biometric)
- Real-time attendance tracking and monitoring
- Break and meal period management
- Overtime calculation and tracking
- Late arrival and early departure detection
- Shift scheduling and assignment
- Geolocation and geofencing capabilities
- Attendance policy enforcement and exceptions
- Time off requests and approvals
- Attendance analytics and reporting
- Integration with payroll and billing systems
- Mobile app for remote clock-in/out
- Kiosk mode for on-site time tracking

**Out of Scope:**
- Timesheet management and approval (handled in Timesheets module)
- Complex scheduling and shift planning (handled in separate modules)
- Leave management and accrual (handled in separate modules)
- Labor cost allocation and project tracking

### 2.3 Key Stakeholders
- **HR Department:** Attendance policy management and compliance
- **Payroll Department:** Time data for payroll processing
- **Managers:** Team attendance monitoring and approval
- **Employees:** Clock-in/out functionality and time tracking
- **IT Department:** System integration and technical support
- **Compliance Officers:** Labor law compliance and audit support

--- END OF SECTION 2 ---

## 3. CORE MODELS (DJANGO)

### 3.1 Primary Model: TimeEntry

```python
class TimeEntry(models.Model):
    """
    Main time entry model for clock-in/out tracking
    """
    
    # Primary Key
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    
    # Foreign Keys
    company_id = models.UUIDField()
    employee_id = models.UUIDField()
    shift_id = models.UUIDField(null=True, blank=True)
    created_by_user_id = models.UUIDField()
    updated_by_user_id = models.UUIDField()
    
    # Entry Details
    entry_number = models.CharField(max_length=50)
    entry_date = models.DateField()
    
    # Clock In Information
    clock_in_time = models.DateTimeField()
    clock_in_method = models.CharField(max_length=20, choices=[
        ('web', 'Web'),
        ('mobile', 'Mobile'),
        ('kiosk', 'Kiosk'),
        ('biometric', 'Biometric'),
        ('rfid', 'RFID Card'),
        ('facial_recognition', 'Facial Recognition'),
        ('manual', 'Manual'),
    ])
    
    clock_in_location = models.CharField(max_length=200, blank=True)
    clock_in_ip_address = models.GenericIPAddressField(null=True, blank=True)
    clock_in_device_id = models.CharField(max_length=100, blank=True)
    clock_in_coordinates = models.JSONField(default=dict, blank=True)
    
    # Clock Out Information
    clock_out_time = models.DateTimeField(null=True, blank=True)
    clock_out_method = models.CharField(max_length=20, choices=[
        ('web', 'Web'),
        ('mobile', 'Mobile'),
        ('kiosk', 'Kiosk'),
        ('biometric', 'Biometric'),
        ('rfid', 'RFID Card'),
        ('facial_recognition', 'Facial Recognition'),
        ('manual', 'Manual'),
        ('auto', 'Auto'),
    ], blank=True)
    
    clock_out_location = models.CharField(max_length=200, blank=True)
    clock_out_ip_address = models.GenericIPAddressField(null=True, blank=True)
    clock_out_device_id = models.CharField(max_length=100, blank=True)
    clock_out_coordinates = models.JSONField(default=dict, blank=True)
    
    # Time Calculations
    total_hours = models.DecimalField(max_digits=8, decimal_places=2, null=True, blank=True)
    regular_hours = models.DecimalField(max_digits=8, decimal_places=2, null=True, blank=True)
    overtime_hours = models.DecimalField(max_digits=8, decimal_places=2, null=True, blank=True)
    double_time_hours = models.DecimalField(max_digits=8, decimal_places=2, null=True, blank=True)
    
    # Break Information
    break_start_time = models.DateTimeField(null=True, blank=True)
    break_end_time = models.DateTimeField(null=True, blank=True)
    break_duration = models.DecimalField(max_digits=8, decimal_places=2, null=True, blank=True)
    unpaid_break = models.BooleanField(default=True)
    
    # Status and Validation
    status = models.CharField(max_length=20, choices=[
        ('active', 'Active'),
        ('completed', 'Completed'),
        ('missed_clock_out', 'Missed Clock Out'),
        ('pending_approval', 'Pending Approval'),
        ('approved', 'Approved'),
        ('rejected', 'Rejected'),
        ('adjusted', 'Adjusted'),
        ('voided', 'Voided'),
    ], default='active')
    
    validation_status = models.CharField(max_length=20, choices=[
        ('not_validated', 'Not Validated'),
        ('valid', 'Valid'),
        ('invalid', 'Invalid'),
        ('warning', 'Warning'),
    ], default='not_validated')
    
    # Attendance Flags
    is_late = models.BooleanField(default=False)
    is_early_departure = models.BooleanField(default=False)
    is_overtime = models.BooleanField(default=False)
    is_weekend = models.BooleanField(default=False)
    is_holiday = models.BooleanField(default=False)
    
    # Notes and Comments
    employee_notes = models.TextField(blank=True)
    manager_notes = models.TextField(blank=True)
    system_notes = models.TextField(blank=True)
    
    # Approval Information
    approved_by_user_id = models.UUIDField(null=True, blank=True)
    approved_date = models.DateTimeField(null=True, blank=True)
    approval_comments = models.TextField(blank=True)
    
    # Audit Fields
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'hr_time_entries'
        verbose_name = 'Time Entry'
        verbose_name_plural = 'Time Entries'
        indexes = [
            models.Index(fields=['company_id', 'employee_id'], name='idx_time_employee'),
            models.Index(fields=['company_id', 'entry_date'], name='idx_time_date'),
            models.Index(fields=['company_id', 'status'], name='idx_time_status'),
            models.Index(fields=['company_id', 'clock_in_time'], name='idx_time_clock_in'),
        ]
        constraints = [
            models.UniqueConstraint(fields=['company_id', 'entry_number'], name='uk_time_entry_number'),
        ]
```

### 3.2 Supporting Model: AttendanceException

```python
class AttendanceException(models.Model):
    """
    Attendance exceptions and policy violations
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    time_entry_id = models.UUIDField()
    employee_id = models.UUIDField()
    
    # Exception Details
    exception_type = models.CharField(max_length=50, choices=[
        ('late_arrival', 'Late Arrival'),
        ('early_departure', 'Early Departure'),
        ('missed_clock_in', 'Missed Clock In'),
        ('missed_clock_out', 'Missed Clock Out'),
        ('unauthorized_break', 'Unauthorized Break'),
        ('excessive_break', 'Excessive Break'),
        ('overtime_violation', 'Overtime Violation'),
        ('shift_violation', 'Shift Violation'),
        ('location_violation', 'Location Violation'),
        ('device_violation', 'Device Violation'),
    ])
    
    exception_severity = models.CharField(max_length=20, choices=[
        ('low', 'Low'),
        ('medium', 'Medium'),
        ('high', 'High'),
        ('critical', 'Critical'),
    ], default='medium')
    
    # Exception Details
    exception_description = models.TextField()
    expected_time = models.DateTimeField(null=True, blank=True)
    actual_time = models.DateTimeField(null=True, blank=True)
    variance_minutes = models.IntegerField(null=True, blank=True)
    
    # Policy Information
    policy_name = models.CharField(max_length=200, blank=True)
    policy_rule = models.CharField(max_length=500, blank=True)
    policy_threshold = models.IntegerField(null=True, blank=True)
    
    # Status and Resolution
    status = models.CharField(max_length=20, choices=[
        ('open', 'Open'),
        ('under_review', 'Under Review'),
        ('resolved', 'Resolved'),
        ('escalated', 'Escalated'),
        ('dismissed', 'Dismissed'),
    ], default='open')
    
    resolution = models.CharField(max_length=50, choices=[
        ('employee_corrected', 'Employee Corrected'),
        ('manager_approved', 'Manager Approved'),
        ('hr_approved', 'HR Approved'),
        ('auto_corrected', 'Auto Corrected'),
        ('dismissed', 'Dismissed'),
    ], blank=True)
    
    resolution_notes = models.TextField(blank=True)
    resolved_by_user_id = models.UUIDField(null=True, blank=True)
    resolved_date = models.DateTimeField(null=True, blank=True)
    
    # Notifications
    employee_notified = models.BooleanField(default=False)
    manager_notified = models.BooleanField(default=False)
    hr_notified = models.BooleanField(default=False)
    
    # Audit Fields
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'hr_attendance_exceptions'
        verbose_name = 'Attendance Exception'
        verbose_name_plural = 'Attendance Exceptions'
        indexes = [
            models.Index(fields=['company_id', 'time_entry_id'], name='idx_exception_time_entry'),
            models.Index(fields=['company_id', 'employee_id'], name='idx_exception_employee'),
            models.Index(fields=['company_id', 'status'], name='idx_exception_status'),
        ]
```

### 3.3 Supporting Model: AttendancePolicy

```python
class AttendancePolicy(models.Model):
    """
    Attendance policies and rules configuration
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    
    # Policy Details
    policy_name = models.CharField(max_length=200)
    policy_code = models.CharField(max_length=50)
    policy_type = models.CharField(max_length=50, choices=[
        ('general', 'General Attendance'),
        ('late_arrival', 'Late Arrival'),
        ('early_departure', 'Early Departure'),
        ('break_policy', 'Break Policy'),
        ('overtime', 'Overtime'),
        ('weekend', 'Weekend'),
        ('holiday', 'Holiday'),
        ('remote_work', 'Remote Work'),
    ])
    
    # Policy Scope
    applies_to_all = models.BooleanField(default=True)
    applies_to_departments = models.JSONField(default=list, blank=True)
    applies_to_employees = models.JSONField(default=list, blank=True)
    applies_to_shifts = models.JSONField(default=list, blank=True)
    
    # Time Rules
    grace_period_minutes = models.IntegerField(default=0)
    late_threshold_minutes = models.IntegerField(default=5)
    early_departure_threshold_minutes = models.IntegerField(default=5)
    
    # Break Rules
    break_required = models.BooleanField(default=True)
    break_duration_minutes = models.IntegerField(default=30)
    break_after_hours = models.DecimalField(max_digits=4, decimal_places=2, default=4.0)
    max_break_duration_minutes = models.IntegerField(default=60)
    
    # Overtime Rules
    overtime_after_hours = models.DecimalField(max_digits=4, decimal_places=2, default=8.0)
    overtime_rate_multiplier = models.DecimalField(max_digits=4, decimal_places=2, default=1.5)
    double_time_after_hours = models.DecimalField(max_digits=4, decimal_places=2, default=12.0)
    
    # Location Rules
    location_required = models.BooleanField(default=False)
    allowed_locations = models.JSONField(default=list, blank=True)
    geofence_enabled = models.BooleanField(default=False)
    geofence_radius_meters = models.IntegerField(null=True, blank=True)
    
    # Device Rules
    allowed_devices = models.JSONField(default=list, blank=True)
    device_verification_required = models.BooleanField(default=False)
    biometric_required = models.BooleanField(default=False)
    
    # Exception Handling
    auto_approve_exceptions = models.BooleanField(default=False)
    exception_approval_workflow = models.JSONField(default=dict, blank=True)
    
    # Status and Dates
    status = models.CharField(max_length=20, choices=[
        ('draft', 'Draft'),
        ('active', 'Active'),
        ('inactive', 'Inactive'),
        ('archived', 'Archived'),
    ], default='draft')
    
    effective_date = models.DateField()
    expiry_date = models.DateField(null=True, blank=True)
    
    # Configuration
    description = models.TextField(blank=True)
    policy_document_url = models.URLField(blank=True)
    
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'hr_attendance_policies'
        verbose_name = 'Attendance Policy'
        verbose_name_plural = 'Attendance Policies'
        indexes = [
            models.Index(fields=['company_id', 'policy_type'], name='idx_policy_type'),
            models.Index(fields=['company_id', 'status'], name='idx_policy_status'),
        ]
        constraints = [
            models.UniqueConstraint(fields=['company_id', 'policy_code'], name='uk_policy_code'),
        ]
```

--- END OF SECTION 3 ---

## 4. REFERENCE MODELS (DJANGO)

### 4.1 Shift

```python
class Shift(models.Model):
    """
    Shift configuration for attendance
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    shift_name = models.CharField(max_length=200)
    shift_code = models.CharField(max_length=50)
    start_time = models.TimeField()
    end_time = models.TimeField()
    days_of_week = models.JSONField(default=list)
    is_active = models.BooleanField(default=True)
    
    class Meta:
        db_table = 'hr_shifts'
        verbose_name = 'Shift'
        verbose_name_plural = 'Shifts'
```

### 4.2 AttendanceDevice

```python
class AttendanceDevice(models.Model):
    """
    Attendance devices for clock-in/out
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField()
    device_name = models.CharField(max_length=200)
    device_type = models.CharField(max_length=50)
    device_id = models.CharField(max_length=100)
    location = models.CharField(max_length=200)
    is_active = models.BooleanField(default=True)
    
    class Meta:
        db_table = 'hr_attendance_devices'
        verbose_name = 'Attendance Device'
        verbose_name_plural = 'Attendance Devices'
```

--- END OF SECTION 4 ---

## 5. FOREIGN KEY RELATIONSHIPS

### 5.1 Primary Relationships
- **TimeEntry** → **Employee**: Employee time tracking
- **TimeEntry** → **Shift**: Shift assignment
- **AttendanceException** → **TimeEntry**: Exception for time entry
- **AttendanceException** → **Employee**: Employee exception
- **AttendancePolicy** → **Company**: Company policy

### 5.2 Many-to-Many Relationships
- **TimeEntry** ↔ **AttendanceException**: One-to-many relationship
- **AttendancePolicy** ↔ **Employee**: Many-to-many through policy scope

--- END OF SECTION 5 ---

## 6. BUSINESS RULES & VALIDATIONS

### 6.1 Data Integrity Rules
- Time entries must have valid clock-in times
- Clock-out times must be after clock-in times
- Break periods must be within work hours
- Overtime calculations must follow labor laws
- Location validation for geofenced entries

### 6.2 Validation Logic
```python
def clean_clock_times(self):
    """
    Validate clock-in and clock-out times
    """
    if self.clock_out_time and self.clock_out_time <= self.clock_in_time:
        raise ValidationError("Clock out time must be after clock in time")

def clean_break_times(self):
    """
    Validate break period times
    """
    if self.break_start_time and self.break_end_time:
        if self.break_start_time <= self.clock_in_time:
            raise ValidationError("Break start must be after clock in")
        
        if self.break_end_time >= self.clock_out_time:
            raise ValidationError("Break end must be before clock out")

def clean_total_hours(self):
    """
    Validate total hours calculation
    """
    if self.total_hours and self.total_hours < 0:
        raise ValidationError("Total hours cannot be negative")
```

### 6.3 Business Constraints
- Maximum work hours per day: 24 hours
- Maximum overtime per day: 16 hours
- Minimum break duration: 15 minutes
- Maximum break duration: 2 hours

--- END OF SECTION 6 ---

## 7. UI/UX SPECIFICATIONS

### 7.1 User Interface Requirements
- **Layout:** Dashboard with clock-in/out interface and attendance overview
- **Navigation:** Quick access to clock-in/out functionality
- **Responsiveness:** Mobile-optimized for on-the-go time tracking
- **Views:** Employee view, Manager view, HR view

### 7.2 User Experience Design
- **User Flow:** Clock in → Work → Take breaks → Clock out → Review time
- **Error Handling:** Clear error messages for invalid entries
- **Real-time Updates:** Live attendance status display
- **Quick Actions:** One-click clock-in/out functionality

### 7.3 Accessibility Standards
- **WCAG Compliance:** WCAG 2.1 AA
- **Keyboard Navigation:** Full keyboard accessibility
- **Screen Reader Support:** Proper ARIA labels and semantic HTML

### 7.4 Visual Design System
- **Color Scheme:** Status-based color coding for attendance
- **Typography:** Clear, readable fonts for time display
- **Iconography:** Intuitive icons for clock-in/out actions

--- END OF SECTION 7 ---

## 8. INTEGRATION POINTS

### 8.1 External Systems
- **Biometric Devices:** Fingerprint and facial recognition systems
- **Access Control Systems:** RFID card and badge systems
- **GPS Services:** Location verification and geofencing
- **Time Clock Hardware:** Physical time clock integration
- **Mobile Device Management**: Mobile app security and management

### 8.2 Internal APIs
- **Employee Management API:** Employee profile and schedule data
- **Payroll API:** Time data export for payroll processing
- **Scheduling API:** Shift information and assignments
- **Notification API:** Attendance alerts and notifications
- **Reporting API:** Attendance analytics and reporting

--- END OF SECTION 8 ---

## 9. API SPECIFICATIONS

### 9.1 REST Endpoints

#### **POST /api/time-entries/clock-in/**
- **Purpose:** Clock in employee
- **Authentication:** JWT token required
- **Request Body:** Clock-in details (location, method, notes)
- **Response:** Created time entry object

#### **POST /api/time-entries/clock-out/**
- **Purpose:** Clock out employee
- **Authentication:** JWT token required
- **Request Body:** Clock-out details (notes, break info)
- **Response:** Updated time entry object

#### **GET /api/time-entries/active/**
- **Purpose:** Get active time entry for employee
- **Authentication:** JWT token required
- **Parameters**: `employee_id` (UUID): Employee ID
- **Response:** Active time entry object

#### **GET /api/time-entries/**
- **Purpose:** Retrieve time entries list
- **Authentication:** JWT token required
- **Parameters**: 
  - `employee_id` (UUID): Filter by employee
  - `date_from` (date): Filter by start date
  - `date_to` (date): Filter by end date
  - `status` (string): Filter by status
- **Response:** Paginated list of time entries

#### **GET /api/time-entries/{entry_id}/**
- **Purpose:** Retrieve specific time entry details
- **Authentication:** JWT token required
- **Parameters:** `entry_id` (UUID)
- **Response:** Complete time entry object

#### **PUT /api/time-entries/{entry_id}/**
- **Purpose:** Update time entry
- **Authentication:** JWT token with appropriate permissions
- **Request Body:** Updated time entry data
- **Response:** Updated time entry object

#### **POST /api/time-entries/{entry_id}/approve/**
- **Purpose:** Approve time entry
- **Authentication:** JWT token with approval permissions
- **Request Body:** Approval details
- **Response:** Updated time entry status

#### **GET /api/attendance-exceptions/**
- **Purpose:** Retrieve attendance exceptions
- **Authentication:** JWT token required
- **Parameters**: 
  - `employee_id` (UUID): Filter by employee
  - `status` (string): Filter by status
  - `exception_type` (string): Filter by type
- **Response:** List of attendance exceptions

#### **GET /api/attendance-policies/**
- **Purpose:** Retrieve attendance policies
- **Authentication:** JWT token required
- **Parameters**: `policy_type` (string): Filter by type
- **Response:** List of attendance policies

### 9.2 Data Formats
- **Request Format:** JSON
- **Response Format:** JSON
- **Error Format:** Standardized error response with validation details

--- END OF SECTION 9 ---

## 10. SECURITY REQUIREMENTS

### 10.1 Authentication
- **Method:** JWT-based authentication with role-based access
- **Authorization:** Time entry access based on user role and relationship
- **Session Management:** Secure session handling with timeout

### 10.2 Data Protection
- **Encryption:** Encrypted storage for location and biometric data
- **Privacy Controls:** Location data privacy and access restrictions
- **Data Masking:** Sensitive information masking for unauthorized viewers

### 10.3 Access Control
- **Permissions:**
  - **Employee:** Clock-in/out for own time entries
  - **Manager:** View and approve team time entries
  - **HR Admin:** Full access to all time entries and policies
  - **Payroll Admin:** Read-only access to time data
- **Audit Trail:** Complete audit logging for all time entry changes

--- END OF SECTION 10 ---

## 11. PERFORMANCE CONSIDERATIONS

### 11.1 Database Optimization
- **Indexing Strategy:** Optimized indexes on employee IDs and dates
- **Query Optimization:** Efficient time data retrieval with proper joins
- **Connection Pooling:** Database connection management for high-volume clock-ins

### 11.2 Caching Strategy
- **Cache Layers:** Redis for frequently accessed attendance data
- **Cache Invalidation:** Smart cache invalidation on time updates
- **Performance Metrics:** Sub-200ms response time for clock-in/out operations

--- END OF SECTION 11 ---

## 12. TESTING REQUIREMENTS

### 12.1 Unit Tests
- **Coverage Target:** 85%
- **Test Framework:** pytest with Django test extensions
- **Test Data:** Factory Boy for comprehensive test data generation

### 12.2 Integration Tests
- **API Testing:** Complete API endpoint testing
- **Device Integration Testing:** Biometric and RFID device validation
- **Location Testing:** Geofencing and GPS validation

### 12.3 User Acceptance Tests
- **UAT Scenarios:** Complete clock-in/out workflows
- **Cross-browser Testing:** Compatibility across major browsers
- **Mobile Testing:** Responsive design validation

--- END OF SECTION 12 ---

## 13. DEPLOYMENT SPECIFICATIONS

### 13.1 Environment Requirements
- **Development:** Local development with mock device APIs
- **Staging:** Full integration testing with attendance devices
- **Production:** Scalable cloud infrastructure with device integration

### 13.2 Configuration Management
- **Settings:** Environment-specific configuration
- **API Keys:** Secure management of device and service credentials
- **Security Settings:** Production security hardening

--- END OF SECTION 13 ---

## 14. MAINTENANCE & SUPPORT

### 14.1 Regular Maintenance
- **Data Cleanup:** Regular archiving of historical time data
- **Performance Monitoring:** Time tracking system performance
- **Security Updates:** Regular security patching

### 14.2 Support Procedures
- **User Support:** Help desk integration for time tracking issues
- **Documentation:** Comprehensive user guides and API documentation
- **Training:** Regular training sessions for employees and managers

--- END OF SECTION 14 ---

## 15. VERSION CONTROL

### 15.1 Version History
- **v1.0.0:** Initial release with basic clock-in/out functionality
- **v1.1.0:** Enhanced mobile app and geofencing features
- **v1.2.0:** Advanced biometric integration and analytics

### 15.2 Change Management
- **Release Process:** Structured release with rollback capability
- **Migration Scripts:** Database migration handling
- **Feature Flags:** Gradual feature rollout capability

--- END OF SECTION 15 ---

## 16. COMPLIANCE & AUDIT

### 16.1 Regulatory Compliance
- **FLSA Compliance:** Fair Labor Standards Act adherence
- **State Labor Laws:** State-specific attendance requirements
- **Data Privacy:** Location and biometric data privacy compliance
- **Accessibility:** ADA compliance for time tracking systems

### 16.2 Audit Requirements
- **Audit Trail:** Complete change history logging for all time entries
- **Attendance Reports:** Automated generation of required reports
- **Access Logging:** Comprehensive access audit logging
- **Compliance Reports:** Automated compliance reporting and validation

--- END OF SECTION 16 ---

**END OF BBP TEMPLATE**
