# CRM User Management - Business Blueprint

## **1. MODULE IDENTIFICATION**

**Module Name:** User Management  
**Module Number:** 8.2  
**Module Type:** Configuration  
**Complexity:** Simple  
**Template Type:** Focused (6 sections)  
**Target File:** CRM/08.Reports & Administration/8.2User Management.md  
**Created Date:** December 31, 2025  
**Version:** 1.0  
**Author:** CRM System  

--- END OF SECTION 1 ---

## **2. PURPOSE**

### **2.1 Business Purpose**
The User Management module provides comprehensive user administration capabilities for the CRM system, enabling secure user provisioning, role-based access control, and permission management across the organization.

### **2.2 Business Scope**
**In Scope:**
- User account creation, management, and deactivation
- Role-based access control with granular permissions
- User profile management and authentication
- Team and territory assignment
- User activity monitoring and audit logging

**Out of Scope:**
- Advanced identity federation and SSO configuration
- Complex workflow automation for user provisioning
- External directory synchronization (LDAP/Active Directory)

### **2.3 Key Stakeholders**
- **System Administrators:** User account management and security
- **HR Department:** Employee onboarding and offboarding
- **Department Managers:** Team member access management
- **IT Security:** Access control and compliance monitoring

--- END OF SECTION 2 ---

## **3. CORE MODELS (DJANGO)**

### **3.1 Primary Model: User**

```python
import uuid
from django.db import models
from django.contrib.auth.models import AbstractUser

class CRMUser(AbstractUser):
    """
    Extended user model for CRM system with role-based access control
    """
    
    # Primary Key
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    
    # Company Multi-tenancy
    company_id = models.UUIDField(db_index=True)
    
    # User Profile
    employee_id = models.CharField(max_length=50, unique=True)
    phone = models.CharField(max_length=20, blank=True, null=True)
    department = models.CharField(max_length=100, blank=True, null=True)
    job_title = models.CharField(max_length=200, blank=True, null=True)
    
    # CRM Specific
    is_sales_rep = models.BooleanField(default=False)
    is_sales_manager = models.BooleanField(default=False)
    is_marketing_user = models.BooleanField(default=False)
    is_system_admin = models.BooleanField(default=False)
    
    # Status
    is_active_crm = models.BooleanField(default=True)
    last_login_crm = models.DateTimeField(null=True, blank=True)
    
    # Audit Fields
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'crm_users'
        verbose_name = 'CRM User'
        verbose_name_plural = 'CRM Users'
        indexes = [
            models.Index(fields=['company_id', 'is_active_crm'], name='idx_company_active'),
            models.Index(fields=['employee_id'], name='idx_employee_id'),
            models.Index(fields=['department'], name='idx_department'),
        ]
    
    def __str__(self):
        return f"{self.get_full_name()} ({self.employee_id})"
```

### **3.2 Supporting Models**

```python
class Role(models.Model):
    """
    Role definitions for CRM access control
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField(db_index=True)
    name = models.CharField(max_length=100)
    description = models.TextField(blank=True, null=True)
    permissions = models.JSONField(default=dict)
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        db_table = 'crm_roles'
        verbose_name = 'Role'
        verbose_name_plural = 'Roles'

class UserRole(models.Model):
    """
    User role assignments
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    user_id = models.UUIDField(db_index=True)
    role_id = models.UUIDField(db_index=True)
    assigned_by_user_id = models.UUIDField()
    assigned_at = models.DateTimeField(auto_now_add=True)
    is_active = models.BooleanField(default=True)
    
    class Meta:
        db_table = 'crm_user_roles'
        verbose_name = 'User Role'
        verbose_name_plural = 'User Roles'
        indexes = [
            models.Index(fields=['user_id', 'is_active'], name='idx_user_active'),
        ]
```

--- END OF SECTION 3 ---

## **4. BUSINESS RULES & VALIDATIONS**

### **4.1 Data Integrity Rules**
- **Employee ID Uniqueness:** Employee IDs must be unique within company scope
- **Email Uniqueness:** User emails must be unique across the system
- **Role Assignment:** Users must have at least one active role
- **Access Control:** Inactive users cannot access CRM system

### **4.2 Validation Logic**
```python
def clean_user_creation(self):
    """
    Validate user creation rules
    """
    if self.email and CRMUser.objects.filter(email=self.email).exists():
        raise models.ValidationError({'email': 'Email already exists in system'})
    
    if not self.employee_id:
        raise models.ValidationError({'employee_id': 'Employee ID is required'})

def validate_role_assignment(self):
    """
    Validate role assignment constraints
    """
    if self.is_system_admin and not self.is_active_crm:
        raise models.ValidationError('System administrators must be active')
```

### **4.3 Business Constraints**
- **Security Policies:** Password complexity and expiration requirements
- **Access Levels:** Hierarchical permission inheritance
- **Audit Requirements:** All user changes must be logged
- **Compliance:** Data privacy and access control compliance

--- END OF SECTION 4 ---

## **5. UI/UX SPECIFICATIONS**

### **5.1 User Interface Requirements**
- **Layout Structure:** Clean, intuitive admin interface with responsive design
- **Navigation:** Easy access to user lists, role management, and permission settings
- **User Management:** Bulk operations for user activation/deactivation
- **Role Configuration:** Visual role builder with permission checkboxes

### **5.2 User Experience Design**
- **User Flow:** User Creation → Role Assignment → Permission Configuration → Activation
- **Search & Filter:** Advanced user search with multiple criteria
- **Bulk Operations:** Efficient bulk user management capabilities
- **Error Handling:** Clear validation messages and error recovery

### **5.3 Key Features**
- **User Dashboard:** Overview of user statistics and activity
- **Role Management:** Drag-and-drop permission assignment
- **Audit Trail:** Complete user activity history
- **Security Settings:** Password policies and access controls

--- END OF SECTION 5 ---

## **6. SECTIONS 8-16: NOT APPLICABLE**

*This is a Configuration module using the focused template. Sections 8-16 are not applicable as this module focuses on configuration models, business rules, and user interface specifications rather than full technical implementation details.*

--- END OF BBP ---
