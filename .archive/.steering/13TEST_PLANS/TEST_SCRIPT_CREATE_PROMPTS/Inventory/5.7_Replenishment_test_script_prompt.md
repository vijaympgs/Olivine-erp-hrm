# 5.7 Replenishment — Test Script Prompt
File to be created by Agent:
**5.7_Replenishment_test_script.py**

---

## OBJECTIVE

Validate **Inventory Replenishment** logic:
- Reorder Point definitions
- Safety Stock calculations
- Min-Max logic
- Replenishment Suggestions generation

This test suite must execute **REP-TS-01 → REP-TS-05** using **real reference master data only**.

---

## GLOBAL EXECUTION RULES (MANDATORY)

1. ❌ NO mock data
2. ✅ USE ONLY existing reference masters
3. ✅ Use Django ORM models only
4. ✅ Follow BBP 5.7 strictly

---

## TEST SCRIPT STRUCTURE

```python
# file: 5.7_Replenishment_test_script.py

from django.test import TestCase
from django.contrib.auth import get_user_model
from decimal import Decimal

from domain.inventory.models import ReorderPolicy, StockLevel
from domain.company.models import Company, Location, ItemVariant
```

---

## BASE TEST SETUP

```python
class ReplenishmentTestCase(TestCase):
    @classmethod
    def setUpTestData(cls):
        cls.company = Company.objects.filter(is_active=True).first()
        cls.location = Location.objects.first()
        cls.variant = ItemVariant.objects.filter(is_active=True).first()
        cls.user = get_user_model().objects.first()
        
        # Ensure policy allows reordering
        ReorderPolicy.objects.create(
            company=cls.company,
            location=cls.location,
            variant=cls.variant,
            min_qty=Decimal('10.00'),
            reorder_qty=Decimal('50.00'),
            active=True
        )
```

---

## TEST CASES

### REP-TS-01: Low Stock Detection
```python
def test_rep_01_low_stock_detection(self):
    """Verify system detects stock below min_qty"""
    # Set Stock to 5 (Min is 10)
    level, _ = StockLevel.objects.get_or_create(
        company=self.company, variant=self.variant, location=self.location
    )
    level.on_hand_qty = Decimal('5.00')
    level.save()
    
    policy = ReorderPolicy.objects.get(variant=self.variant, location=self.location)
    self.assertTrue(level.on_hand_qty < policy.min_qty)
```

### REP-TS-02: Safety Stock Alert
```python
def test_rep_02_safety_stock_alert(self):
    """Verify alert when dipping into safety stock buffer (simulated logic)"""
    pass # Implement checking logic
```

### REP-TS-03: Reorder Suggestion Calculation
```python
def test_rep_03_suggestion_calc(self):
    """Verify suggestion = Max - Current or Fixed Reorder Qty"""
    pass # Implement calculation check
```

---

## AGENT EXECUTION INSTRUCTION (LOCKED)

**Run Task:** 5.7 Replenishment — Test Automation

- Create `5.7_Replenishment_test_script.py`
- Implement REP-TS-01 → REP-TS-05
- Use `ReorderPolicy` model
- Verify Logic
