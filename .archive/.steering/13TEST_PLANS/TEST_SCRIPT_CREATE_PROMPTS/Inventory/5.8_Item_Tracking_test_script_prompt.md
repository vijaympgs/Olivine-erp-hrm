# 5.8 Item Tracking — Test Script Prompt
File to be created by Agent:
**5.8_Item_Tracking_test_script.py**

---

## OBJECTIVE

Validate **Batch & Serial Tracking** logic:
- Batch creation and lifecycle
- Serial number generation and status tracking
- Expiry date management
- Traceability (Movements per batch)

This test suite must execute **TRK-TS-01 → TRK-TS-05** using **real reference master data only**.

---

## GLOBAL EXECUTION RULES (MANDATORY)

1. ❌ NO mock data
2. ✅ USE ONLY existing reference masters
3. ✅ Use Django ORM models only
4. ✅ Follow BBP 5.8 strictly

---

## TEST SCRIPT STRUCTURE

```python
# file: 5.8_Item_Tracking_test_script.py

from django.test import TestCase
from django.contrib.auth import get_user_model
from django.utils import timezone
from datetime import timedelta
import uuid

from domain.inventory.models import Batch, SerialNumber, StockMovement
from domain.company.models import Company, Location, ItemVariant
```

---

## BASE TEST SETUP

```python
class TrackingTestCase(TestCase):
    @classmethod
    def setUpTestData(cls):
        cls.company = Company.objects.filter(is_active=True).first()
        cls.variant = ItemVariant.objects.filter(is_active=True).first()
        cls.user = get_user_model().objects.first()
```

---

## TEST CASES

### TRK-TS-01: Create Batch
```python
def test_trk_01_create_batch(self):
    """Verify Batch creation with expiry"""
    batch_no = f"BATCH-{uuid.uuid4().hex[:6].upper()}"
    expiry = timezone.now().date() + timedelta(days=365)
    
    batch = Batch.objects.create(
        company=self.company,
        variant=self.variant,
        batch_number=batch_no,
        expiry_date=expiry
    )
    self.assertIsNotNone(batch.pk)
    self.assertEqual(batch.expiry_date, expiry)
```

### TRK-TS-02: Serial Number Lifecycle
```python
def test_trk_02_serial_lifecycle(self):
    """Verify Serial creation and status flow"""
    serial_no = f"SN-{uuid.uuid4().hex[:6].upper()}"
    serial = SerialNumber.objects.create(
        company=self.company,
        variant=self.variant,
        serial_number=serial_no,
        status='AVAILABLE'
    )
    
    serial.status = 'SOLD'
    serial.save()
    self.assertEqual(SerialNumber.objects.get(pk=serial.pk).status, 'SOLD')
```

### TRK-TS-03: Expiry Alert
```python
def test_trk_03_expiry_check(self):
    """Verify expired batches logic"""
    # Logic to filter batches where expiry_date < now
    pass
```

---

## AGENT EXECUTION INSTRUCTION (LOCKED)

**Run Task:** 5.8 Item Tracking — Test Automation

- Create `5.8_Item_Tracking_test_script.py`
- Implement TRK-TS-01 → TRK-TS-05
- Use `Batch` and `SerialNumber` models
