# CRM System Settings - Business Blueprint

## **1. MODULE IDENTIFICATION**

**Module Name:** System Settings  
**Module Number:** 8.3  
**Module Type:** Configuration  
**Complexity:** Simple  
**Template Type:** Focused (6 sections)  
**Target File:** CRM/08.Reports & Administration/8.3System Settings.md  
**Created Date:** December 31, 2025  
**Version:** 1.0  
**Author:** CRM System  

--- END OF SECTION 1 ---

## **2. PURPOSE**

### **2.1 Business Purpose**
The System Settings module provides centralized configuration management for the CRM system, enabling administrators to customize system behavior, define business rules, and manage global settings across all CRM modules.

### **2.2 Business Scope**
**In Scope:**
- Global system configuration and preferences
- Module-specific settings and parameters
- Business rule configuration
- System-wide defaults and thresholds
- Feature flags and toggle management
- Notification and alert settings

**Out of Scope:**
- Advanced system architecture configuration
- Database performance tuning
- Server infrastructure management
- Third-party system integration settings

### **2.3 Key Stakeholders**
- **System Administrators:** System configuration and maintenance
- **Business Analysts:** Business rule setup and validation
- **Department Managers:** Module-specific configuration
- **IT Support:** System troubleshooting and optimization

--- END OF SECTION 2 ---

## **3. CORE MODELS (DJANGO)**

### **3.1 Primary Model: SystemSetting**

```python
import uuid
from django.db import models

class SystemSetting(models.Model):
    """
    System-wide configuration settings and parameters
    """
    
    # Primary Key
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    
    # Company Multi-tenancy
    company_id = models.UUIDField(db_index=True)
    
    # Setting Definition
    setting_key = models.CharField(max_length=200, db_index=True)
    setting_value = models.TextField()
    setting_type = models.CharField(
        max_length=20,
        choices=[
            ('string', 'String'),
            ('integer', 'Integer'),
            ('decimal', 'Decimal'),
            ('boolean', 'Boolean'),
            ('json', 'JSON'),
        ],
        default='string'
    )
    
    # Categorization
    category = models.CharField(max_length=100, db_index=True)
    module = models.CharField(max_length=100, blank=True, null=True)
    description = models.TextField(blank=True, null=True)
    
    # Configuration
    is_editable = models.BooleanField(default=True)
    is_system_setting = models.BooleanField(default=False)
    validation_rule = models.TextField(blank=True, null=True)
    
    # Audit Fields
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    updated_by_user_id = models.UUIDField()
    
    class Meta:
        db_table = 'crm_system_settings'
        verbose_name = 'System Setting'
        verbose_name_plural = 'System Settings'
        indexes = [
            models.Index(fields=['company_id', 'category'], name='idx_company_category'),
            models.Index(fields=['setting_key'], name='idx_setting_key'),
            models.Index(fields=['module'], name='idx_module'),
        ]
        constraints = [
            models.UniqueConstraint(
                fields=['company_id', 'setting_key'],
                name='uk_company_setting_key'
            ),
        ]
    
    def __str__(self):
        return f"{self.setting_key} = {self.setting_value}"
```

### **3.2 Supporting Models**

```python
class FeatureFlag(models.Model):
    """
    Feature toggle management for gradual rollouts
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField(db_index=True)
    feature_name = models.CharField(max_length=200, db_index=True)
    is_enabled = models.BooleanField(default=False)
    rollout_percentage = models.IntegerField(default=0)
    target_users = models.JSONField(default=list, blank=True)
    description = models.TextField(blank=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        db_table = 'crm_feature_flags'
        verbose_name = 'Feature Flag'
        verbose_name_plural = 'Feature Flags'

class NotificationTemplate(models.Model):
    """
    Email and notification templates
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField(db_index=True)
    template_name = models.CharField(max_length=200)
    template_type = models.CharField(
        max_length=20,
        choices=[
            ('email', 'Email'),
            ('sms', 'SMS'),
            ('push', 'Push Notification'),
            ('in_app', 'In-App'),
        ]
    )
    subject_template = models.CharField(max_length=500, blank=True, null=True)
    body_template = models.TextField()
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        db_table = 'crm_notification_templates'
        verbose_name = 'Notification Template'
        verbose_name_plural = 'Notification Templates'
```

--- END OF SECTION 3 ---

## **4. BUSINESS RULES & VALIDATIONS**

### **4.1 Data Integrity Rules**
- **Setting Uniqueness:** Setting keys must be unique within company scope
- **Type Validation:** Setting values must match defined data types
- **System Protection:** System settings require admin privileges to modify
- **Feature Flags:** Feature rollouts must follow controlled release process

### **4.2 Validation Logic**
```python
def clean_setting_value(self):
    """
    Validate setting value based on type and rules
    """
    if self.setting_type == 'integer':
        try:
            int(self.setting_value)
        except ValueError:
            raise models.ValidationError('Setting value must be an integer')
    
    elif self.setting_type == 'decimal':
        try:
            float(self.setting_value)
        except ValueError:
            raise models.ValidationError('Setting value must be a decimal')
    
    elif self.setting_type == 'boolean':
        if self.setting_value.lower() not in ['true', 'false', '1', '0']:
            raise models.ValidationError('Setting value must be true or false')

def validate_feature_flag(self):
    """
    Validate feature flag configuration
    """
    if self.rollout_percentage < 0 or self.rollout_percentage > 100:
        raise models.ValidationError('Rollout percentage must be between 0 and 100')
```

### **4.3 Business Constraints**
- **Configuration Hierarchy:** Company settings override system defaults
- **Change Management:** Critical setting changes require approval
- **Audit Requirements:** All setting changes must be logged
- **Rollback Capability:** Settings must support rollback to previous values

--- END OF SECTION 4 ---

## **5. UI/UX SPECIFICATIONS**

### **5.1 User Interface Requirements**
- **Layout Structure:** Organized settings dashboard with category navigation
- **Search & Filter:** Quick setting search with category filtering
- **Bulk Operations:** Efficient bulk setting updates and exports
- **Validation Feedback:** Real-time validation and error messaging

### **5.2 User Experience Design**
- **User Flow:** Setting Discovery → Configuration → Validation → Application
- **Setting Groups:** Logical categorization by module and functionality
- **Change Preview:** Preview impact of setting changes before application
- **Version Control:** Setting history and rollback capabilities

### **5.3 Key Features**
- **Settings Dashboard:** Overview of all system configurations
- **Feature Flag Manager:** Controlled feature rollout interface
- **Template Editor:** WYSIWYG editor for notification templates
- **Import/Export:** Bulk setting management capabilities

--- END OF SECTION 5 ---

## **6. SECTIONS 8-16: NOT APPLICABLE**

*This is a Configuration module using the focused template. Sections 8-16 are not applicable as this module focuses on configuration models, business rules, and user interface specifications rather than full technical implementation details.*

--- END OF BBP ---
