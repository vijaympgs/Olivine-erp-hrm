# CRM Data Import-Export - Business Blueprint

## **1. MODULE IDENTIFICATION**

**Module Name:** Data Import-Export  
**Module Number:** 8.4  
**Module Type:** Configuration  
**Complexity:** Simple  
**Template Type:** Focused (6 sections)  
**Target File:** CRM/08.Reports & Administration/8.4Data Import-Export.md  
**Created Date:** December 31, 2025  
**Version:** 1.0  
**Author:** CRM System  

--- END OF SECTION 1 ---

## **2. PURPOSE**

### **2.1 Business Purpose**
The Data Import-Export module provides comprehensive data migration capabilities for the CRM system, enabling bulk data operations, backup/restore functionality, and integration with external data sources through standardized import and export processes.

### **2.2 Business Scope**
**In Scope:**
- Bulk data import from CSV, Excel, and JSON files
- Data export in multiple formats (CSV, Excel, PDF, JSON)
- Data validation and cleansing during import
- Import/export job scheduling and monitoring
- Data mapping and field configuration
- Error handling and rollback capabilities

**Out of Scope:**
- Real-time API data synchronization
- Advanced ETL pipeline configuration
- Third-party system integration workflows
- Complex data transformation logic

### **2.3 Key Stakeholders**
- **Data Administrators:** Data migration and quality management
- **Sales Operations:** Lead and account data imports
- **Marketing Teams:** Campaign data exports and imports
- **IT Support:** Data integrity and system maintenance

--- END OF SECTION 2 ---

## **3. CORE MODELS (DJANGO)**

### **3.1 Primary Model: ImportExportJob**

```python
import uuid
from django.db import models

class ImportExportJob(models.Model):
    """
    Data import and export job management
    """
    
    # Primary Key
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    
    # Company Multi-tenancy
    company_id = models.UUIDField(db_index=True)
    
    # Job Definition
    job_type = models.CharField(
        max_length=20,
        choices=[
            ('import', 'Import'),
            ('export', 'Export'),
        ],
        db_index=True
    )
    job_status = models.CharField(
        max_length=20,
        choices=[
            ('pending', 'Pending'),
            ('running', 'Running'),
            ('completed', 'Completed'),
            ('failed', 'Failed'),
            ('cancelled', 'Cancelled'),
        ],
        default='pending',
        db_index=True
    )
    
    # Data Configuration
    target_model = models.CharField(max_length=100)  # Lead, Contact, Account, etc.
    file_format = models.CharField(
        max_length=10,
        choices=[
            ('csv', 'CSV'),
            ('excel', 'Excel'),
            ('json', 'JSON'),
            ('pdf', 'PDF'),
        ]
    )
    file_path = models.CharField(max_length=500, blank=True, null=True)
    
    # Processing Details
    total_records = models.IntegerField(default=0)
    processed_records = models.IntegerField(default=0)
    success_records = models.IntegerField(default=0)
    error_records = models.IntegerField(default=0)
    
    # Configuration
    field_mapping = models.JSONField(default=dict, blank=True)
    validation_rules = models.JSONField(default=dict, blank=True)
    duplicate_handling = models.CharField(
        max_length=20,
        choices=[
            ('skip', 'Skip'),
            ('update', 'Update'),
            ('create_new', 'Create New'),
        ],
        default='skip'
    )
    
    # Audit Fields
    created_by_user_id = models.UUIDField()
    created_at = models.DateTimeField(auto_now_add=True)
    started_at = models.DateTimeField(null=True, blank=True)
    completed_at = models.DateTimeField(null=True, blank=True)
    
    class Meta:
        db_table = 'crm_import_export_jobs'
        verbose_name = 'Import/Export Job'
        verbose_name_plural = 'Import/Export Jobs'
        indexes = [
            models.Index(fields=['company_id', 'job_type'], name='idx_company_job_type'),
            models.Index(fields=['job_status', 'created_at'], name='idx_status_created'),
            models.Index(fields=['target_model'], name='idx_target_model'),
        ]
    
    def __str__(self):
        return f"{self.job_type.title()} Job - {self.target_model}"
```

### **3.2 Supporting Models**

```python
class ImportExportLog(models.Model):
    """
    Detailed logging for import/export operations
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    job_id = models.UUIDField(db_index=True)
    record_number = models.IntegerField()
    log_level = models.CharField(
        max_length=10,
        choices=[
            ('info', 'Info'),
            ('warning', 'Warning'),
            ('error', 'Error'),
        ]
    )
    message = models.TextField()
    record_data = models.JSONField(default=dict, blank=True)
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        db_table = 'crm_import_export_logs'
        verbose_name = 'Import/Export Log'
        verbose_name_plural = 'Import/Export Logs'
        indexes = [
            models.Index(fields=['job_id', 'log_level'], name='idx_job_log_level'),
        ]

class DataTemplate(models.Model):
    """
    Predefined templates for common import/export operations
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    company_id = models.UUIDField(db_index=True)
    template_name = models.CharField(max_length=200)
    target_model = models.CharField(max_length=100)
    template_type = models.CharField(
        max_length=20,
        choices=[
            ('import', 'Import'),
            ('export', 'Export'),
        ]
    )
    field_mapping = models.JSONField(default=dict)
    validation_rules = models.JSONField(default=dict)
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        db_table = 'crm_data_templates'
        verbose_name = 'Data Template'
        verbose_name_plural = 'Data Templates'
```

--- END OF SECTION 3 ---

## **4. BUSINESS RULES & VALIDATIONS**

### **4.1 Data Integrity Rules**
- **File Validation:** Uploaded files must match expected format and structure
- **Field Mapping:** Required fields must be mapped for successful import
- **Data Validation:** Imported data must pass model validation rules
- **Duplicate Handling:** Configurable duplicate detection and resolution

### **4.2 Validation Logic**
```python
def validate_file_format(self):
    """
    Validate uploaded file format and structure
    """
    if self.file_format == 'csv':
        # Validate CSV structure
        if not self.file_path.endswith('.csv'):
            raise models.ValidationError('File must be CSV format')
    
    elif self.file_format == 'excel':
        # Validate Excel structure
        if not self.file_path.endswith(('.xlsx', '.xls')):
            raise models.ValidationError('File must be Excel format')

def validate_field_mapping(self):
    """
    Validate field mapping configuration
    """
    required_fields = self.get_required_fields_for_model(self.target_model)
    mapped_fields = list(self.field_mapping.values())
    
    for field in required_fields:
        if field not in mapped_fields:
            raise models.ValidationError(f'Required field {field} is not mapped')

def validate_import_data(self, record_data):
    """
    Validate individual record during import
    """
    try:
        # Apply model validation
        model_class = self.get_model_class(self.target_model)
        instance = model_class(**record_data)
        instance.full_clean()
    except Exception as e:
        raise models.ValidationError(f'Validation error: {str(e)}')
```

### **4.3 Business Constraints**
- **File Size Limits:** Maximum file size restrictions for uploads
- **Processing Limits:** Concurrent job limits per company
- **Data Retention:** Job history and log retention policies
- **Security Restrictions:** File type and content validation

--- END OF SECTION 4 ---

## **5. UI/UX SPECIFICATIONS**

### **5.1 User Interface Requirements**
- **Layout Structure:** Intuitive wizard interface for import/export setup
- **File Upload:** Drag-and-drop file upload with progress indicators
- **Field Mapping:** Visual field mapping interface with preview
- **Job Monitoring:** Real-time job status and progress tracking

### **5.2 User Experience Design**
- **User Flow:** File Selection → Configuration → Validation → Processing → Results
- **Template Management:** Save and reuse common import/export configurations
- **Error Handling:** Clear error reporting with correction guidance
- **Progress Tracking:** Real-time progress bars and status updates

### **5.3 Key Features**
- **Import Wizard:** Step-by-step guided import process
- **Export Builder:** Flexible export configuration with filters
- **Template Library:** Pre-built templates for common operations
- **Job Dashboard:** Overview of all import/export activities

--- END OF SECTION 5 ---

## **6. SECTIONS 8-16: NOT APPLICABLE**

*This is a Configuration module using the focused template. Sections 8-16 are not applicable as this module focuses on configuration models, business rules, and user interface specifications rather than full technical implementation details.*

--- END OF BBP ---
